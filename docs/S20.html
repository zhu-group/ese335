<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Section 20 Plotting with R (I): ggplot2</title>

<script src="site_libs/header-attrs-2.24/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/font-awesome-6.4.2/css/all.min.css" rel="stylesheet" />
<link href="site_libs/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>







<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Environmental Data Analysis</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="Syllabus.html">
    <span class="fa fa-bell-o"></span>
     
    Syllabus
  </a>
</li>
<li>
  <a href="Schedule.html">
    <span class="fa fa-calendar"></span>
     
    Schedule
  </a>
</li>
<li>
  <a href="Resource.html">
    <span class="fa fa-wrench"></span>
     
    Resource
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-laptop"></span>
     
    Assignments
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="A01.html">Assignment 01</a>
    </li>
    <li>
      <a href="A02.html">Assignment 02</a>
    </li>
    <li>
      <a href="A03.html">Assignment 03</a>
    </li>
    <li>
      <a href="A04.html">Assignment 04</a>
    </li>
    <li>
      <a href="A05.html">Assignment 05</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Section 20 Plotting with R (I):
<code>ggplot2</code></h1>

</div>


<hr />
<div id="prerequisites" class="section level1">
<h1>Prerequisites</h1>
<p>Load the libraries with R:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(gapminder)</span></code></pre></div>
<pre><code>## Warning: 程辑包&#39;gapminder&#39;是用R版本4.3.3 来建造的</code></pre>
<hr />
<p><em>This section is modified from the excellent <a
href="https://r4ds.had.co.nz/data-visualisation.html#introduction-1">Data
visualisation</a> and <a
href="http://r-statistics.co/ggplot2-Tutorial-With-R.html">How to make
any plot in <code>ggplot2</code>?</a>, both are freely available
online.</em></p>
<p><code>ggplot2</code> is the most elegant and aesthetically pleasing
graphics framework available in R. It implements the <strong>grammar of
graphics</strong>, a coherent system for describing and building graphs.
It can significantly improve your plots’ quality and make you much more
efficient in creating them. With that being said, the learning curve is
steep because the way you make plots with <code>ggplot2</code> is very
different from base graphics making in R and in other languages. The
distinctive feature of the <code>ggplot2</code> framework is the way you
make plots through <strong>adding layers</strong>. Here we will learn
the steps of making a plot with <code>ggplot2</code>. More about
<code>ggplot2</code>, check <a
href="http://r-statistics.co/ggplot2-Tutorial-With-R.html">How to make
any plot in <code>ggplot2</code>?</a>.</p>
<hr />
</div>
<div id="steps-of-plotting-with-ggplot2" class="section level1">
<h1>Steps of plotting with <code>ggplot2</code></h1>
<div id="passing-the-data-set" class="section level2">
<h2>1. Passing the data set</h2>
<p>First of all, you need to tell R what data set to use in plotting.
This is done by passing a <em>data.frame</em> object to the
<code>ggplot()</code> function. Here the data frame object should
contain <strong>all</strong> features needed to make the plot you want.
Unlike base graphics in R and other languages, <code>ggplot()</code>
does not take vectors as arguments.</p>
<p>In previous sections, you learn how to use the pipe operator
(<code>%&gt;%</code>) to pass a data set (<code>tibble</code> object)
produced through <a
href="https://zhu-group.github.io/ese335/S02.html">data wrangling</a> to
the <code>ggplot()</code> function. This is exactly what you need to do
in this step.</p>
<p>Let’s use the <code>gapminder</code> data set. Now suppose we want to
look at how GDP per capita (<code>gdpPercap</code>) changes from 1957 to
2007 for countries with names starting with the letter “C” in Asia or
Europe. (I make up this subjective example, but hopefully, you can feel
the power of the <code>dplyr</code> package!) We can then pass the
subset of <code>gapminder</code> data to <code>ggplot</code> to make a
scatter plot between <code>gdpPercap</code> and <code>year</code>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># Make a simple scatter plot</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>( continent<span class="sc">==</span><span class="st">&quot;Asia&quot;</span> <span class="sc">|</span> continent<span class="sc">==</span><span class="st">&quot;Europe&quot;</span> ) <span class="sc">%&gt;%</span>   </span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>( <span class="fu">substr</span>(country,<span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">==</span><span class="st">&quot;C&quot;</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>  <span class="fu">ggplot</span>( <span class="fu">aes</span>(<span class="at">x=</span>year, <span class="at">y=</span>gdpPercap) ) <span class="sc">+</span> </span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="S20_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
</div>
<div id="mapping-the-aesthetics" class="section level2">
<h2>2. Mapping the aesthetics</h2>
<p>The plot above, however, can not distinguish countries as all points
are plotted in the same manner. In fact, we would like to add
<code>country</code> as the third variable to the two dimensional
scatter plot. By doing so, we are mapping the scatter plot to an
<em>aesthetic</em>. An aesthetic is a visual property of the objects in
your plot. Aesthetics include things like the <code>size</code>,
<code>shape</code>, <code>color</code>, or even transparency
(<code>alpha</code>) of the points. You can display a point (like the
one below) in different ways by changing the values of its aesthetic
properties.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># Add an aesthetic - color</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>( continent<span class="sc">==</span><span class="st">&quot;Asia&quot;</span> <span class="sc">|</span> continent<span class="sc">==</span><span class="st">&quot;Europe&quot;</span> ) <span class="sc">%&gt;%</span>   </span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>( <span class="fu">substr</span>(country,<span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">==</span><span class="st">&quot;C&quot;</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>  <span class="fu">ggplot</span>( <span class="fu">aes</span>(<span class="at">x=</span>year, <span class="at">y=</span>gdpPercap, <span class="at">color=</span>country) ) <span class="sc">+</span> </span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="S20_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>To map an aesthetic to a variable, associate the name of the
aesthetic to the name of the variable inside <code>aes()</code>.
<code>ggplot2</code> will automatically assign a unique level of the
aesthetic (here a unique color) to each unique value of the variable, a
process known as <em>scaling</em>. <code>ggplot2</code> will also add a
<em>legend</em> that explains which levels correspond to which
values.</p>
<p>In the above example, we mapped <code>country</code> to the
<code>color</code> aesthetic, but we could have mapped
<code>country</code> to the <code>size</code> aesthetic in the same way.
In this case, the exact size of each point would reveal its class
affiliation.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co"># Add an aesthetic - size</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>( continent<span class="sc">==</span><span class="st">&quot;Asia&quot;</span> <span class="sc">|</span> continent<span class="sc">==</span><span class="st">&quot;Europe&quot;</span> ) <span class="sc">%&gt;%</span>   </span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>( <span class="fu">substr</span>(country,<span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">==</span><span class="st">&quot;C&quot;</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>  <span class="fu">ggplot</span>( <span class="fu">aes</span>(<span class="at">x=</span>year, <span class="at">y=</span>gdpPercap, <span class="at">size=</span>country) ) <span class="sc">+</span> </span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<pre><code>## Warning: Using size for a discrete variable is not advised.</code></pre>
<p><img src="S20_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>We get a warning here, because mapping an unordered variable
(<code>country</code>) to an ordered aesthetic (<code>size</code>) is
not a good idea. We can ignore the warning for now.</p>
<p>Similarly, we could map <code>country</code> to the
<code>shape</code> or <code>alpha</code> aesthetic:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># Add an aesthetic - shape</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>( continent<span class="sc">==</span><span class="st">&quot;Asia&quot;</span> <span class="sc">|</span> continent<span class="sc">==</span><span class="st">&quot;Europe&quot;</span> ) <span class="sc">%&gt;%</span>   </span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>( <span class="fu">substr</span>(country,<span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">==</span><span class="st">&quot;C&quot;</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>  <span class="fu">ggplot</span>( <span class="fu">aes</span>(<span class="at">x=</span>year, <span class="at">y=</span>gdpPercap, <span class="at">shape=</span>country) ) <span class="sc">+</span> </span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="S20_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co"># Add an aesthetic - transparency</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>( continent<span class="sc">==</span><span class="st">&quot;Asia&quot;</span> <span class="sc">|</span> continent<span class="sc">==</span><span class="st">&quot;Europe&quot;</span> ) <span class="sc">%&gt;%</span>   </span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>( <span class="fu">substr</span>(country,<span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">==</span><span class="st">&quot;C&quot;</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>  <span class="fu">ggplot</span>( <span class="fu">aes</span>(<span class="at">x=</span>year, <span class="at">y=</span>gdpPercap, <span class="at">alpha=</span>country) ) <span class="sc">+</span> </span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<pre><code>## Warning: Using alpha for a discrete variable is not advised.</code></pre>
<p><img src="S20_files/figure-html/unnamed-chunk-5-2.png" width="672" /></p>
<p>You can even combine more than one aesthetic:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="co"># Add two aesthetics - color + shape</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>( continent<span class="sc">==</span><span class="st">&quot;Asia&quot;</span> <span class="sc">|</span> continent<span class="sc">==</span><span class="st">&quot;Europe&quot;</span> ) <span class="sc">%&gt;%</span>   </span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>( <span class="fu">substr</span>(country,<span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">==</span><span class="st">&quot;C&quot;</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>  <span class="fu">ggplot</span>( <span class="fu">aes</span>(<span class="at">x=</span>year, <span class="at">y=</span>gdpPercap, <span class="at">color=</span>country, <span class="at">shape=</span>country) ) <span class="sc">+</span> </span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="S20_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="co"># Add two aesthetics - shape + size</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>( continent<span class="sc">==</span><span class="st">&quot;Asia&quot;</span> <span class="sc">|</span> continent<span class="sc">==</span><span class="st">&quot;Europe&quot;</span> ) <span class="sc">%&gt;%</span>   </span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>( <span class="fu">substr</span>(country,<span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">==</span><span class="st">&quot;C&quot;</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>  <span class="fu">ggplot</span>( <span class="fu">aes</span>(<span class="at">x=</span>year, <span class="at">y=</span>gdpPercap, <span class="at">color=</span>country, <span class="at">shape=</span>continent, <span class="at">size=</span>country) ) <span class="sc">+</span> </span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<pre><code>## Warning: Using size for a discrete variable is not advised.</code></pre>
<p><img src="S20_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>Once you map an aesthetic, <code>ggplot2</code> takes care of the
rest. It selects a reasonable scale to use with the aesthetic, and it
constructs a legend that explains the mapping between levels and
values.</p>
</div>
<div id="adding-more-geometric-objects" class="section level2">
<h2>3. Adding more geometric objects</h2>
<p>In the previous steps, we make a scatter plot between
<code>gdpPercap</code> and <code>year</code>. The plot uses a visual
object to represent the data. In <code>ggplot2</code> syntax, we say the
plot uses a geometrical object or <em>geom</em>.</p>
<p>People often describe plots by the type of geom that the plot uses.
For example, bar charts use bar geoms, line charts use line geoms,
boxplots use boxplot geoms, and so on. <code>ggplot2</code> provides
over 40 geoms, and extension packages provide even more (see <a
href="https://exts.ggplot2.tidyverse.org/gallery/">here</a> for a
sampling). The best way to get a comprehensive overview is <a
href="https://nyu-cdsc.github.io/learningr/assets/data-visualization-2.1.pdf">ggplot2
cheatsheet</a>. To learn more about any single geom, use <code>?</code>,
for example <code>?geom_smooth</code>.</p>
<p>In <code>ggplot2</code>, you can use “+” to add another geom to the
plot. In the plot below, we add a smoothed line to the scatter plots
from the individual country.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="co"># Use two geoms - point + smooth line</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>( continent<span class="sc">==</span><span class="st">&quot;Asia&quot;</span> <span class="sc">|</span> continent<span class="sc">==</span><span class="st">&quot;Europe&quot;</span> ) <span class="sc">%&gt;%</span>   </span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>( <span class="fu">substr</span>(country,<span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">==</span><span class="st">&quot;C&quot;</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>  <span class="fu">ggplot</span>( <span class="fu">aes</span>(<span class="at">x=</span>year, <span class="at">y=</span>gdpPercap, <span class="at">color=</span>country) ) <span class="sc">+</span> </span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>  <span class="fu">geom_smooth</span>()</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula = &#39;y ~ x&#39;</code></pre>
<p><img src="S20_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
</div>
<div id="changing-the-labels" class="section level2">
<h2>4. Changing the labels</h2>
<p>Now that you have drawn the main parts of the plot. You might want to
add the plot’s main title and perhaps change the X and Y axis titles.
This can be accomplished using the <code>labs</code> layer, meant for
specifying the labels. However, manipulating the size, the color of the
labels is the job of the ‘Theme’.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="co"># Change labels</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>( continent<span class="sc">==</span><span class="st">&quot;Asia&quot;</span> <span class="sc">|</span> continent<span class="sc">==</span><span class="st">&quot;Europe&quot;</span> ) <span class="sc">%&gt;%</span>   </span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>( <span class="fu">substr</span>(country,<span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">==</span><span class="st">&quot;C&quot;</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>  <span class="fu">ggplot</span>( <span class="fu">aes</span>(<span class="at">x=</span>year, <span class="at">y=</span>gdpPercap, <span class="at">color=</span>country) ) <span class="sc">+</span> </span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;GDP per captia from 1957 to 2007&quot;</span>, <span class="at">x=</span><span class="st">&quot;Year&quot;</span>, <span class="at">y=</span><span class="st">&quot;GDP per captia&quot;</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula = &#39;y ~ x&#39;</code></pre>
<p><img src="S20_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
</div>
<div id="adjusting-the-theme" class="section level2">
<h2>5. Adjusting the theme</h2>
<p>Very often, we want to customize our plot to make it looks better.
For example we may need to increase the size of the labels and/or change
the legend title. Adjusting the size of labels can be done using the
<code>theme()</code> function by setting the<code>plot.title</code>,
<code>axis.text.x</code>, and <code>axis.text.y</code> option. They need
to be specified inside the <code>element_text()</code>. If you want to
remove any of them, set it to <code>element_blank()</code>, and it will
vanish entirely.</p>
<p>Adjusting the legend title is a bit tricky. If your legend is that of
a <code>color</code> attribute and it varies based on a factor, you need
to set the <code>name</code> using the
<code>scale_color_discrete()</code> function, where the color part
belongs to the color attribute and the <em>discrete</em> because the
legend is based on a factor variable.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="co"># Change the theme</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>( continent<span class="sc">==</span><span class="st">&quot;Asia&quot;</span> <span class="sc">|</span> continent<span class="sc">==</span><span class="st">&quot;Europe&quot;</span> ) <span class="sc">%&gt;%</span>   </span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>( <span class="fu">substr</span>(country,<span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">==</span><span class="st">&quot;C&quot;</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a>  <span class="fu">ggplot</span>( <span class="fu">aes</span>(<span class="at">x=</span>year, <span class="at">y=</span>gdpPercap, <span class="at">color=</span>country) ) <span class="sc">+</span> </span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;GDP per captia from 1957 to 2007&quot;</span>, <span class="at">x=</span><span class="st">&quot;Year&quot;</span>, <span class="at">y=</span><span class="st">&quot;GDP per captia&quot;</span>) <span class="sc">+</span></span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">20</span>, <span class="at">face=</span><span class="st">&quot;bold&quot;</span>), </span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a>        <span class="at">axis.text.x=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>), </span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a>        <span class="at">axis.text.y=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>),</span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a>        <span class="at">axis.title.x=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">20</span>),</span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a>        <span class="at">axis.title.y=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">20</span>)) <span class="sc">+</span> </span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">name=</span><span class="st">&quot;Country Name&quot;</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula = &#39;y ~ x&#39;</code></pre>
<p><img src="S20_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
</div>
<div id="using-the-facets" class="section level2">
<h2>6. Using the facets</h2>
<p>For categorical variables, it is particularly useful to split your
plot into <em>facets</em>, subplots that each display one subset of the
data. To facet your plot by a single variable, use
<code>facet_wrap()</code>. The first argument of
<code>facet_wrap()</code> should be a formula, which you create with
<code>~</code> followed by a variable name. The variable that you pass
to <code>facet_wrap()</code> should be discrete.</p>
<p>Let’s split our plot into two facets based on
<code>continent</code>:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="co"># Using the facets</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>( continent<span class="sc">==</span><span class="st">&quot;Asia&quot;</span> <span class="sc">|</span> continent<span class="sc">==</span><span class="st">&quot;Europe&quot;</span> ) <span class="sc">%&gt;%</span>   </span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>( <span class="fu">substr</span>(country,<span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">==</span><span class="st">&quot;C&quot;</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>  <span class="fu">ggplot</span>( <span class="fu">aes</span>(<span class="at">x=</span>year, <span class="at">y=</span>gdpPercap, <span class="at">color=</span>country) ) <span class="sc">+</span> </span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;GDP per captia from 1957 to 2007&quot;</span>, <span class="at">x=</span><span class="st">&quot;Year&quot;</span>, <span class="at">y=</span><span class="st">&quot;GDP per captia&quot;</span>) <span class="sc">+</span></span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">20</span>, <span class="at">face=</span><span class="st">&quot;bold&quot;</span>), </span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a>        <span class="at">axis.text.x=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>), </span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a>        <span class="at">axis.text.y=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>),</span>
<span id="cb19-13"><a href="#cb19-13" tabindex="-1"></a>        <span class="at">axis.title.x=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">20</span>),</span>
<span id="cb19-14"><a href="#cb19-14" tabindex="-1"></a>        <span class="at">axis.title.y=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">20</span>)) <span class="sc">+</span> </span>
<span id="cb19-15"><a href="#cb19-15" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">name=</span><span class="st">&quot;Country Name&quot;</span>) <span class="sc">+</span></span>
<span id="cb19-16"><a href="#cb19-16" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( <span class="sc">~</span> continent)</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula = &#39;y ~ x&#39;</code></pre>
<p><img src="S20_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>One way to change the layout the facets is specifying
<code>ncol</code> and <code>nrow</code> options in the
<code>facet_wrap()</code> function:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="co"># Using the facets - 2 rows (2x1)</span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>( continent<span class="sc">==</span><span class="st">&quot;Asia&quot;</span> <span class="sc">|</span> continent<span class="sc">==</span><span class="st">&quot;Europe&quot;</span> ) <span class="sc">%&gt;%</span>   </span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>( <span class="fu">substr</span>(country,<span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">==</span><span class="st">&quot;C&quot;</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a>  <span class="fu">ggplot</span>( <span class="fu">aes</span>(<span class="at">x=</span>year, <span class="at">y=</span>gdpPercap, <span class="at">color=</span>country) ) <span class="sc">+</span> </span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;GDP per captia from 1957 to 2007&quot;</span>, <span class="at">x=</span><span class="st">&quot;Year&quot;</span>, <span class="at">y=</span><span class="st">&quot;GDP per captia&quot;</span>) <span class="sc">+</span></span>
<span id="cb21-9"><a href="#cb21-9" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb21-10"><a href="#cb21-10" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">20</span>, <span class="at">face=</span><span class="st">&quot;bold&quot;</span>), </span>
<span id="cb21-11"><a href="#cb21-11" tabindex="-1"></a>        <span class="at">axis.text.x=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>), </span>
<span id="cb21-12"><a href="#cb21-12" tabindex="-1"></a>        <span class="at">axis.text.y=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>),</span>
<span id="cb21-13"><a href="#cb21-13" tabindex="-1"></a>        <span class="at">axis.title.x=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">20</span>),</span>
<span id="cb21-14"><a href="#cb21-14" tabindex="-1"></a>        <span class="at">axis.title.y=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">20</span>)) <span class="sc">+</span> </span>
<span id="cb21-15"><a href="#cb21-15" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">name=</span><span class="st">&quot;Country Name&quot;</span>) <span class="sc">+</span></span>
<span id="cb21-16"><a href="#cb21-16" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( <span class="sc">~</span> continent, <span class="at">nrow=</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula = &#39;y ~ x&#39;</code></pre>
<p><img src="S20_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
</div>
<div id="saving-the-plot" class="section level2">
<h2>7. Saving the plot</h2>
<p>Finally, you can save the above plot uisng the <code>ggsave()</code>
function. The default is to save the last plot that you displayed, using
the size of the current graphics device. It’s smart enough to guess the
type of graphics device from the extension. Let’s save the above figure
to a local path <code>D://ese335</code> with a name
<code>myplot.png</code>:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="co"># Save a ggplot figure</span></span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>( continent<span class="sc">==</span><span class="st">&quot;Asia&quot;</span> <span class="sc">|</span> continent<span class="sc">==</span><span class="st">&quot;Europe&quot;</span> ) <span class="sc">%&gt;%</span>   </span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>( <span class="fu">substr</span>(country,<span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">==</span><span class="st">&quot;C&quot;</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a>  <span class="fu">ggplot</span>( <span class="fu">aes</span>(<span class="at">x=</span>year, <span class="at">y=</span>gdpPercap, <span class="at">color=</span>country) ) <span class="sc">+</span> </span>
<span id="cb23-6"><a href="#cb23-6" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb23-7"><a href="#cb23-7" tabindex="-1"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb23-8"><a href="#cb23-8" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;GDP per captia from 1957 to 2007&quot;</span>, <span class="at">x=</span><span class="st">&quot;Year&quot;</span>, <span class="at">y=</span><span class="st">&quot;GDP per captia&quot;</span>) <span class="sc">+</span></span>
<span id="cb23-9"><a href="#cb23-9" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb23-10"><a href="#cb23-10" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">20</span>, <span class="at">face=</span><span class="st">&quot;bold&quot;</span>), </span>
<span id="cb23-11"><a href="#cb23-11" tabindex="-1"></a>        <span class="at">axis.text.x=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>), </span>
<span id="cb23-12"><a href="#cb23-12" tabindex="-1"></a>        <span class="at">axis.text.y=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>),</span>
<span id="cb23-13"><a href="#cb23-13" tabindex="-1"></a>        <span class="at">axis.title.x=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">20</span>),</span>
<span id="cb23-14"><a href="#cb23-14" tabindex="-1"></a>        <span class="at">axis.title.y=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">20</span>)) <span class="sc">+</span> </span>
<span id="cb23-15"><a href="#cb23-15" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">name=</span><span class="st">&quot;Country Name&quot;</span>) <span class="sc">+</span></span>
<span id="cb23-16"><a href="#cb23-16" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( <span class="sc">~</span> continent, <span class="at">nrow=</span><span class="dv">2</span>)</span>
<span id="cb23-17"><a href="#cb23-17" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="st">&quot;myplot.png&quot;</span>)  <span class="co"># save a stored ggplot</span></span></code></pre></div>
<p>You can also change the plot size (<code>width</code> and
<code>height</code>) and resolution (<code>dpi</code>) by setting
corresponding options. Use <code>?ggsave()</code> for more.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="co"># Save a ggplot object</span></span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span></span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>( continent<span class="sc">==</span><span class="st">&quot;Asia&quot;</span> <span class="sc">|</span> continent<span class="sc">==</span><span class="st">&quot;Europe&quot;</span> ) <span class="sc">%&gt;%</span>   </span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>( <span class="fu">substr</span>(country,<span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">==</span><span class="st">&quot;C&quot;</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a>  <span class="fu">ggplot</span>( <span class="fu">aes</span>(<span class="at">x=</span>year, <span class="at">y=</span>gdpPercap, <span class="at">color=</span>country) ) <span class="sc">+</span> </span>
<span id="cb24-6"><a href="#cb24-6" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb24-7"><a href="#cb24-7" tabindex="-1"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb24-8"><a href="#cb24-8" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;GDP per captia from 1957 to 2007&quot;</span>, <span class="at">x=</span><span class="st">&quot;Year&quot;</span>, <span class="at">y=</span><span class="st">&quot;GDP per captia&quot;</span>) <span class="sc">+</span></span>
<span id="cb24-9"><a href="#cb24-9" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb24-10"><a href="#cb24-10" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">20</span>, <span class="at">face=</span><span class="st">&quot;bold&quot;</span>), </span>
<span id="cb24-11"><a href="#cb24-11" tabindex="-1"></a>        <span class="at">axis.text.x=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>), </span>
<span id="cb24-12"><a href="#cb24-12" tabindex="-1"></a>        <span class="at">axis.text.y=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>),</span>
<span id="cb24-13"><a href="#cb24-13" tabindex="-1"></a>        <span class="at">axis.title.x=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">20</span>),</span>
<span id="cb24-14"><a href="#cb24-14" tabindex="-1"></a>        <span class="at">axis.title.y=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">20</span>)) <span class="sc">+</span> </span>
<span id="cb24-15"><a href="#cb24-15" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">name=</span><span class="st">&quot;Country Name&quot;</span>) <span class="sc">+</span></span>
<span id="cb24-16"><a href="#cb24-16" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( <span class="sc">~</span> continent, <span class="at">nrow=</span><span class="dv">2</span>)</span>
<span id="cb24-17"><a href="#cb24-17" tabindex="-1"></a></span>
<span id="cb24-18"><a href="#cb24-18" tabindex="-1"></a><span class="co"># And later save it to a stored figure</span></span>
<span id="cb24-19"><a href="#cb24-19" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;myplot2.png&quot;</span>, <span class="at">plot=</span>plot1, <span class="at">width=</span><span class="dv">20</span>,</span>
<span id="cb24-20"><a href="#cb24-20" tabindex="-1"></a>       <span class="at">height=</span><span class="dv">10</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>, <span class="at">dpi=</span><span class="dv">400</span>)</span></code></pre></div>
<hr />
</div>
</div>
<div id="ggplot2s-grammar-of-graphics-and-beyond"
class="section level1">
<h1><code>ggplot2</code>’s grammar of graphics and beyond</h1>
<p>We have covered some basics but critical steps of making plots with
<code>ggplot2</code>. There are many more features that we don’t have
time to go through in just one section. You can explore the full
functionality of <code>ggplot2()</code> by studying the <a
href="https://zhu-group.github.io/ese335/S20.html#Further_reading">further
reading</a> listed at the end.</p>
<p>To summarize, <code>ggplot2</code>’s grammar of graphics goes
like:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="co"># ggplot functions</span></span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="sc">&lt;</span>DATA<span class="sc">&gt;</span>) <span class="sc">+</span> </span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a>  <span class="er">&lt;</span>GEOM_FUNCTION<span class="sc">&gt;</span>(</span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a>     <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="sc">&lt;</span>MAPPINGS<span class="sc">&gt;</span>),</span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a>     <span class="at">stat =</span> <span class="sc">&lt;</span>STAT<span class="sc">&gt;</span>, </span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a>     <span class="at">position =</span> <span class="sc">&lt;</span>POSITION<span class="sc">&gt;</span></span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a>  <span class="er">&lt;</span>COORDINATE_FUNCTION<span class="sc">&gt;</span> <span class="sc">+</span></span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a>  <span class="er">&lt;</span>FACET_FUNCTION<span class="sc">&gt;</span></span>
<span id="cb25-10"><a href="#cb25-10" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" tabindex="-1"></a><span class="co"># Save a ggplot figure  </span></span>
<span id="cb25-12"><a href="#cb25-12" tabindex="-1"></a><span class="fu">ggsave</span>()  </span></code></pre></div>
<p>The template takes <em>seven parameters</em>, the bracketed words
that appear in the template. We have no time to cover <code>STAT</code>,
<code>POSITION</code>, and <code>COORDINATE_FUNCTION</code>, which you
can learn by yourself following the <a
href="hhttps://zhu-group.github.io/ese335/S20.html#Further_reading">further
reading</a>. In practice, you rarely need to supply all seven parameters
to make a plot because <code>ggplot2</code> will provide useful defaults
for everything except the data, the mappings, and the geom function.</p>
<p>The seven parameters in the template compose the grammar of graphics,
a formal system for building plots. The grammar of graphics is based on
the insight that you can uniquely describe any plot as a combination of
a data set, a geom, a set of mappings, a stat, a position adjustment, a
coordinate system, and a faceting scheme.</p>
<p>With this, you can make any type of plot with
<code>ggplot2()</code>!</p>
<hr />
</div>
<div id="r-graph-gallery" class="section level1">
<h1>R Graph Gallery</h1>
<p>A good way to learn <code>ggplot2</code> is to browse plots (and
scripts!) in the R Graph Gallery, such as:</p>
<ul>
<li><a href="https://www.r-graph-gallery.com/index.html">The R Graph
Gallery</a></li>
<li><a
href="http://r-statistics.co/Top50-Ggplot2-Visualizations-MasterList-R-Code.html">Top
50 <code>ggplot2</code> Visualizations</a></li>
<li><a
href="https://exts.ggplot2.tidyverse.org/gallery/"><code>ggplot2</code>
extensions</a></li>
<li><a href="https://plotly.com/r/">Plotly R Open Source Graphing
Library</a></li>
</ul>
<p>Find the plots you want to mimic, edit and customize the scripts
based on your need.</p>
<hr />
</div>
<div id="in-class-exercises" class="section level1">
<h1>In-class exercises</h1>
<div id="exercise-1" class="section level2">
<h2>Exercise #1</h2>
<p>Can you reproduce the following figure (<code>myfirstplot.png</code>,
width 25 cm, height 20 cm, and dpi 400) with <code>ggplot2</code>?</p>
<p><img src="figs/myfirstplot.png" alt="drawing" width="700"/></p>
<hr />
</div>
</div>
<div id="further-reading" class="section level1">
<h1>Further reading</h1>
<ul>
<li><p><a href="http://vita.had.co.nz/papers/layered-grammar.pdf">A
Layered Grammar of Graphics</a></p></li>
<li><p><a href="https://ggplot2-book.org/"><code>ggplot2</code>: elegant
graphics for data analysis</a></p></li>
<li><p><a
href="https://nyu-cdsc.github.io/learningr/assets/data-visualization-2.1.pdf">Data
Visualization with <code>ggplot2</code> Cheat Sheet</a></p></li>
<li><p><a
href="https://r4ds.had.co.nz/data-visualisation.html#introduction-1">Data
visualisation</a></p></li>
<li><p><a
href="http://r-statistics.co/ggplot2-Tutorial-With-R.html"><code>ggplot2</code>
Short Tutorial</a></p></li>
<li><p><a
href="http://r-statistics.co/ggplot2-cheatsheet.html"><code>ggplot2</code>
Quickref</a></p></li>
</ul>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = false;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
