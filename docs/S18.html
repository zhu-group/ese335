<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Section 18 Time series analysis (I)</title>

<script src="site_libs/header-attrs-2.24/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/font-awesome-6.4.2/css/all.min.css" rel="stylesheet" />
<link href="site_libs/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>







<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Environmental Data Analysis</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="Syllabus.html">
    <span class="fa fa-bell-o"></span>
     
    Syllabus
  </a>
</li>
<li>
  <a href="Schedule.html">
    <span class="fa fa-calendar"></span>
     
    Schedule
  </a>
</li>
<li>
  <a href="Resource.html">
    <span class="fa fa-wrench"></span>
     
    Resource
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-laptop"></span>
     
    Assignments
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="A01.html">Assignment 01</a>
    </li>
    <li>
      <a href="A02.html">Assignment 02</a>
    </li>
    <li>
      <a href="A03.html">Assignment 03</a>
    </li>
    <li>
      <a href="A04.html">Assignment 04</a>
    </li>
    <li>
      <a href="A05.html">Assignment 05</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Section 18 Time series analysis (I)</h1>

</div>


<div id="section-example-co2-data" class="section level1">
<h1>Section example: CO<sub>2</sub> data</h1>
<p>Time series data are data points collected over a period of time as a
<strong>sequence of time gap</strong>. Time series data analysis means
analyzing the available data to find out the pattern or trend in the
data to predict some future values which will, in turn, help more
effective and optimize decisions. Time series analysis examples are
Financial, Stock prices, Weather data, Utility Studies and many
more.</p>
<p>Let’s use the ‘Keeling_Data’ <a
href="https://zhu-group.github.io/ese335/download/co2_mm_mlo.csv">CO<sub>2</sub>
data</a> again as an example to take a closer look at a time series.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># Read data</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>Keeling_Data     <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="st">&quot;co2_mm_mlo.csv&quot;</span>, <span class="at">header =</span> T)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co"># Handel missing values</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>Keeling_Data<span class="sc">$</span>co2[<span class="fu">which</span>(Keeling_Data<span class="sc">$</span>co2<span class="sc">&lt;</span><span class="dv">0</span>)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(Keeling_Data<span class="sc">$</span>co2)){</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>  <span class="cf">if</span>( <span class="fu">is.na</span>(Keeling_Data<span class="sc">$</span>co2[i])){</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>    Keeling_Data<span class="sc">$</span>co2[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(Keeling_Data<span class="sc">$</span>co2[(i<span class="dv">-2</span>)<span class="sc">:</span>(i<span class="sc">+</span><span class="dv">2</span>)],<span class="at">na.rm=</span>T )</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>  }</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>}</span></code></pre></div>
<p>Notice that here we use 5-month average to replace the missing
values.</p>
<p>Use <code>ts()</code> to convert a vector into a time series. Use
<code>?</code> to learn more.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># Apply the ts() function</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>co2 <span class="ot">&lt;-</span> <span class="fu">ts</span>(Keeling_Data<span class="sc">$</span>co2, <span class="at">start=</span><span class="fu">c</span>(<span class="dv">1958</span>,<span class="dv">3</span>), <span class="at">frequency=</span><span class="dv">12</span>)</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co"># Quick plot</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="fu">plot</span>(co2, <span class="at">type=</span><span class="st">&quot;l&quot;</span>)</span></code></pre></div>
<p><img src="S18_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># Check the data type</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="fu">str</span>(co2)</span></code></pre></div>
<pre><code>##  Time-Series [1:791] from 1958 to 2024: 316 317 318 316 316 ...</code></pre>
<hr />
</div>
<div id="quick-look-components-of-a-time-series" class="section level1">
<h1>Quick look: components of a time series</h1>
<p>Generally, an environmental time series, <span
class="math inline">\(Y(t)\)</span>, has three components: trend <span
class="math inline">\(T(t)\)</span>, seasonality (e.g., 12-month cycle)
<span class="math inline">\(S(t)\)</span>, and error <span
class="math inline">\(e(t)\)</span>.</p>
<p><span class="math display">\[ Y(t) = T(t) + S(t) + e(t)\]</span> Here
the error <span class="math inline">\(e(t)\)</span> part is called
<strong>white noise</strong>. A white noise (<span
class="math inline">\(w_t\)</span>) is a collection of
<strong>uncorrelated random variables</strong> with mean <code>0</code>
and finite variance, denoted as: <span class="math display">\[w_t \sim
wn(0,\sigma^2)\]</span></p>
<p>In R, you can use <code>decompose()</code> to quickly decompose a
time series into the three components, particularly for environmental
data set. Here is how it works:</p>
<ul>
<li><p>The function first determines the trend component using a
<em>moving average</em> (if filter is <code>NULL</code>, a symmetric
window with equal weights is used), and removes it from the time
series.</p></li>
<li><p>Then, the seasonal figure is computed by averaging, for each time
unit, over all periods. The seasonal figure is then centered.</p></li>
<li><p>Finally, the error component is determined by removing trend and
seasonal figure (recycled as needed) from the original time
series.</p></li>
</ul>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>co2_components <span class="ot">&lt;-</span> <span class="fu">decompose</span>(co2)</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="fu">plot</span>(co2_components)</span></code></pre></div>
<p><img src="S18_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>In the above example, <code>co2_components</code> contains the
information/values of the three components. Check the distribution of
the error component (<code>random</code>) to verify it’s a white
noise.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co"># Plot hist</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="fu">hist</span>(co2_components<span class="sc">$</span>random, <span class="at">prob=</span><span class="cn">TRUE</span>)</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="co"># Add a normal pdf curve</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dnorm</span>(x, <span class="at">mean=</span><span class="fu">mean</span>(co2_components<span class="sc">$</span>random, <span class="at">na.rm=</span>T),</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>            <span class="at">sd=</span><span class="fu">sd</span>(co2_components<span class="sc">$</span>random, <span class="at">na.rm=</span>T)),</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>      <span class="at">add=</span><span class="cn">TRUE</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="S18_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>As you can see the distribution is a Gaussian white noise, which is a
particularly useful white noise series.</p>
<hr />
<p><em>This section is based on the chapters of Time Series Analysis and
Its Applications With R Example by Robert H. Shumway and David S.
Stoffer.</em></p>
</div>
<div id="arima-modeling" class="section level1">
<h1>ARIMA modeling</h1>
<p>ARIMA is the abbreviation for <em>AutoRegressive Integrated Moving
Average</em>. <em>Auto Regressive</em> (AR) terms refer to the lags of
the differenced series, <em>Moving Average</em> (MA) terms refer to the
lags of errors and <code>I</code> is the number of difference used to
make the time series <em>stationary</em>.</p>
<p>Here stationary actually refers <em>weakly stationary</em> time
series, which is a finite variance process such that:</p>
<ul>
<li><p>The mean value of time-series is constant over time</p></li>
<li><p>The autovariance function does not change over time</p></li>
<li><p>Seasonality effect is minimal</p></li>
</ul>
<div id="ar-model" class="section level2">
<h2>AR model</h2>
<p>Autoregressive models are based on the idea that the current value of
the series, <span class="math inline">\(x_t\)</span>, can be explained
as a function of <code>p</code> past values, <span
class="math inline">\(x_{t-1}\)</span>, <span
class="math inline">\(x_{t-2}\)</span>, …, <span
class="math inline">\(x_{t-p}\)</span>, where <code>p</code> determines
the number of steps into the past needed to forecast the current
value.</p>
<p>An <em>autoregressive</em> (AR) model of order <em>p</em>,
abbreviated <code>AR(p)</code>, is of the form</p>
<p><span class="math display">\[x_t = \phi_1x_{t-1} + \phi_2x_{t-2} +
... + \phi_px_{t-p} + w_t\]</span></p>
<p>where <span class="math inline">\(x_t\)</span> is stationary, <span
class="math inline">\(w_t \sim wn(0, \sigma^2_w)\)</span>, and <span
class="math inline">\(\phi_1\)</span>, <span
class="math inline">\(\phi_2\)</span>, …, <span
class="math inline">\(\phi_p\)</span> are constants.</p>
<p>The following R code can be used to obtain two AR(1) models:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># Make two panels</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>))</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="co"># ARIMA model (1,0,0)</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">arima.sim</span>(<span class="fu">list</span>(<span class="at">order=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">ar=</span>.<span class="dv">9</span>), <span class="at">n=</span><span class="dv">100</span>), <span class="at">ylab=</span><span class="st">&quot;x&quot;</span>,</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="at">main=</span>(<span class="fu">expression</span>(<span class="fu">AR</span>(<span class="dv">1</span>)<span class="sc">~</span><span class="er">~~</span>phi<span class="sc">==+</span>.<span class="dv">9</span>)))</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="co"># ARIMA model (1,0,0)</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">arima.sim</span>(<span class="fu">list</span>(<span class="at">order=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">ar=</span><span class="sc">-</span>.<span class="dv">9</span>), <span class="at">n=</span><span class="dv">100</span>), <span class="at">ylab=</span><span class="st">&quot;x&quot;</span>,</span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a><span class="at">main=</span>(<span class="fu">expression</span>(<span class="fu">AR</span>(<span class="dv">1</span>)<span class="sc">~</span><span class="er">~~</span>phi<span class="sc">==-</span>.<span class="dv">9</span>)))</span></code></pre></div>
<p><img src="S18_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
</div>
<div id="ma-model" class="section level2">
<h2>MA model</h2>
<p>As an alternative to the autoregressive representation in which the
<span class="math inline">\(x_t\)</span> on the left-hand side of the
equation are assumed to be combined linearly, the <em>moving
average</em> (MA) model of order <code>q</code>, abbreviated as
<code>MA(q)</code>, assumes the white noise <span
class="math inline">\(w_t\)</span> on the right-hand side of the
defining equation are combined linearly to form the observed data.</p>
<p>The moving average model of order <code>q</code>, or
<code>MA(q)</code> model, is defined to be</p>
<p><span class="math display">\[x_t = w_t + \theta_1w_{t-1} +
\theta_2w_{t-2} + ... + \theta_qw_{t-q} \]</span></p>
<p>where <span class="math inline">\(w_t \sim wn(0,
\sigma^2_w)\)</span>, and <span class="math inline">\(\theta_1\)</span>,
<span class="math inline">\(\theta_2\)</span>, …, <span
class="math inline">\(\theta_q\)</span> are parameters.</p>
<p>The following R code can be used to obtain two MA(1) models:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co"># Make two panels</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>))</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="co"># ARIMA model (0,0,1)</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">arima.sim</span>(<span class="fu">list</span>(<span class="at">order=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">ma=</span>.<span class="dv">9</span>), <span class="at">n=</span><span class="dv">100</span>), <span class="at">ylab=</span><span class="st">&quot;x&quot;</span>,</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="at">main=</span>(<span class="fu">expression</span>(<span class="fu">MA</span>(<span class="dv">1</span>)<span class="sc">~</span><span class="er">~~</span>theta<span class="sc">==+</span>.<span class="dv">9</span>)))</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="co"># ARIMA model (0,0,1)</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">arima.sim</span>(<span class="fu">list</span>(<span class="at">order=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">ma=</span><span class="sc">-</span>.<span class="dv">9</span>), <span class="at">n=</span><span class="dv">100</span>), <span class="at">ylab=</span><span class="st">&quot;x&quot;</span>,</span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="at">main=</span>(<span class="fu">expression</span>(<span class="fu">MA</span>(<span class="dv">1</span>)<span class="sc">~</span><span class="er">~~</span>theta<span class="sc">==-</span>.<span class="dv">9</span>)))</span></code></pre></div>
<p><img src="S18_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
</div>
<div id="acf-and-pacf" class="section level2">
<h2>ACF and PACF</h2>
<p>The autocorrelation function (ACF) measures the linear predictability
of the series at time <code>t</code>, say <span
class="math inline">\(x_t\)</span>, using only the value <span
class="math inline">\(x_s\)</span>.</p>
<p>The partial auto-correlation function (PACF) is a measure of the
correlation between observations of a time series that are separated by
<code>k</code> time units (<span class="math inline">\(x_t\)</span> and
<span class="math inline">\(x_{t-k}\)</span>), with linear dependence
removed. In other words, the partial autocorrelation at lag
<code>k</code> is the autocorrelation between <span
class="math inline">\(x_t\)</span> and <span
class="math inline">\(x_{t-k}\)</span> that is not accounted for by lags
<code>1</code> through <code>k−1</code>.</p>
<p>To show ACF and the PACF of a AR model, AR(2), in R we can use the
following lines:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co"># Compute ACF and PACF of AR(2)</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>ACF <span class="ot">=</span> <span class="fu">ARMAacf</span>(<span class="at">ar=</span><span class="fu">c</span>(<span class="fl">1.5</span>,<span class="sc">-</span>.<span class="dv">75</span>), <span class="at">ma=</span><span class="dv">0</span>, <span class="dv">24</span>)[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>PACF <span class="ot">=</span> <span class="fu">ARMAacf</span>(<span class="at">ar=</span><span class="fu">c</span>(<span class="fl">1.5</span>,<span class="sc">-</span>.<span class="dv">75</span>), <span class="at">ma=</span><span class="dv">0</span>, <span class="dv">24</span>, <span class="at">pacf=</span><span class="cn">TRUE</span>)</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="co"># Plot ACF and PACF of AR(2)</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="fu">plot</span>(ACF, <span class="at">type=</span><span class="st">&quot;h&quot;</span>, <span class="at">xlab=</span><span class="st">&quot;lag&quot;</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">8</span>,<span class="dv">1</span>)); <span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>)</span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="fu">plot</span>(PACF, <span class="at">type=</span><span class="st">&quot;h&quot;</span>, <span class="at">xlab=</span><span class="st">&quot;lag&quot;</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">8</span>,<span class="dv">1</span>)); <span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>)</span></code></pre></div>
<p><img src="S18_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>To show ACF and the PACF of a MA model, MA(2), in R we can use the
following lines:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="co"># Compute ACF and PACF of MA(2)</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>ACF <span class="ot">=</span> <span class="fu">ARMAacf</span>(<span class="at">ar=</span><span class="dv">0</span>, <span class="at">ma=</span><span class="fu">c</span>(<span class="fl">0.5</span>,<span class="fl">0.6</span>), <span class="dv">24</span>)[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>PACF <span class="ot">=</span> <span class="fu">ARMAacf</span>(<span class="at">ar=</span><span class="dv">0</span>, <span class="at">ma=</span><span class="fu">c</span>(<span class="fl">0.5</span>,<span class="fl">0.6</span>), <span class="dv">24</span>, <span class="at">pacf=</span><span class="cn">TRUE</span>)</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="co"># Plot ACF and PACF of MA(2)</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="fu">plot</span>(ACF, <span class="at">type=</span><span class="st">&quot;h&quot;</span>, <span class="at">xlab=</span><span class="st">&quot;lag&quot;</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">8</span>,<span class="dv">1</span>)); <span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>)</span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="fu">plot</span>(PACF, <span class="at">type=</span><span class="st">&quot;h&quot;</span>, <span class="at">xlab=</span><span class="st">&quot;lag&quot;</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">8</span>,<span class="dv">1</span>)); <span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>)</span></code></pre></div>
<p><img src="S18_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>Behavior of the ACF and PACF for ARMA Models can be summarized
as:</p>
<ul>
<li><p>AR(p): ACF Tails off; PACF Cuts off after lag
<code>p</code></p></li>
<li><p>MA(q): ACF Cuts off after lag <code>q</code>; PACF Tails
off</p></li>
<li><p>ARMA(p, q): ACF Tails off; PACF Tails off</p></li>
</ul>
</div>
<div id="an-example" class="section level2">
<h2>An example</h2>
<p>Consider the global temperature series record
(<code>gtemp_both</code>) in the <code>astsa</code> package. The data
are the global mean land and ocean temperature index from
<code>1850</code> to <code>2023</code>. We want to fit an ARIMA model to
this time series.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="co"># Load data</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="fu">library</span>(astsa)</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="co"># Reset panel</span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a><span class="fu">plot</span>(gtemp_both, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;Global Temperature Deviations&quot;</span>)</span></code></pre></div>
<p><img src="S18_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>There is a clear trend, so the first step is to de-trend the
data.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="co"># Fit a linear model</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>trModel <span class="ot">&lt;-</span> <span class="fu">lm</span>(gtemp_both <span class="sc">~</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(gtemp_both)))</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="co"># Get the residuals</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>residual <span class="ot">&lt;-</span> <span class="fu">resid</span>(trModel)</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="co"># Plot the residual</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="fu">plot</span>(residual, <span class="at">type=</span><span class="st">&quot;l&quot;</span>)</span></code></pre></div>
<p><img src="S18_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="co"># Check acf anf pacf of the residuals</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="fu">acf</span>(residual)</span></code></pre></div>
<p><img src="S18_files/figure-html/unnamed-chunk-10-2.png" width="672" /></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="fu">pacf</span>(residual)</span></code></pre></div>
<p><img src="S18_files/figure-html/unnamed-chunk-10-3.png" width="672" /></p>
<p>Based on the acf and pacf plots, we guess it may be an ARIMA(1,0,0)
model.</p>
<hr />
</div>
</div>
<div id="in-class-exercises" class="section level1">
<h1>In-class exercises</h1>
<div id="exercise-1" class="section level2">
<h2>Exercise #1</h2>
<p>Use the data of the Southern Oscillation Index (SOI;
<code>soi</code>) data from the <code>astsa</code> package.</p>
<ul>
<li><p>Practice the <code>decompose()</code> function.</p></li>
<li><p>Build an ARMA model [Hint: you may want to de-seasonalize the
data before fitting the model]</p></li>
</ul>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = false;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
