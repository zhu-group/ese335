<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Section 02 Data wrangling and quick plots</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 66px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h2 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h3 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h4 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h5 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h6 {
  padding-top: 71px;
  margin-top: -71px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Environmental Data Analysis</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="Syllabus.html">
    <span class="fa fa-bell-o"></span>
     
    Syllabus
  </a>
</li>
<li>
  <a href="Schedule.html">
    <span class="fa fa-calendar"></span>
     
    Schedule
  </a>
</li>
<li>
  <a href="Resource.html">
    <span class="fa fa-wrench"></span>
     
    Resource
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-laptop"></span>
     
    Assignments
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="A01.html">Assignment 01</a>
    </li>
    <li>
      <a href="A02.html">Assignment 02</a>
    </li>
    <li>
      <a href="A03.html">Assignment 03</a>
    </li>
    <li>
      <a href="A04.html">Assignment 04</a>
    </li>
    <li>
      <a href="A05.html">Assignment 05</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Section 02 Data wrangling and quick plots</h1>

</div>


<hr />
<div id="prerequisites" class="section level1">
<h1>Prerequisites</h1>
<p>Install the following packages:</p>
<ul>
<li><code>tidyr</code></li>
<li><code>dplyr</code></li>
<li><code>ggplot2</code></li>
</ul>
<p>Load the libraries with R:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(tidyr)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw">library</span>(ggplot2)</span></code></pre></div>
<hr />
</div>
<div id="section-example-weather-data-from-baoan-airport" class="section level1">
<h1>Section Example: weather data from BaoAn airport</h1>
<p>Environment data, expecially raw observations, are really messy. Here we take a look at hourly weather data measured at BaoAn International Airport during the past 10 years. The data set is from <a href="https://www.ncei.noaa.gov/products/land-based-station/integrated-surface-database">NOAA Integrated Surface Dataset</a>.</p>
<p>Download the file <a href="https://zhu-group.github.io/ese335/download/2281305.zip">2281305.zip</a>, where the number <code>2281305</code> is the site ID.</p>
<p>Extract the zip file, you should see a file named <code>2281305.csv</code>.</p>
<p>Open the file, you see many columns and even more lines, with no clear meaning and definitions. This is very often you would encounter when work with environmental data. As Hadley Wickham puts it, “Tidy datasets are all alike, but every messy dataset is messy in its own way.”</p>
<hr />
<p><em>The notes below are modified from the excellent <a href="http://swcarpentry.github.io/r-novice-gapminder/">Dataframe Manipulation</a> and freely available on the Software Carpentry website.</em></p>
<hr />
</div>
<div id="loading-a-.csv-file" class="section level1">
<h1>Loading a <code>.csv</code> file</h1>
<p><img src="figs/mlo_record.png" alt="drawing" width="800"/></p>
<p><a href="https://scrippsco2.ucsd.edu/history_legacy/keeling_curve_lessons.html">Figure source</a></p>
<p><a href="https://scrippsco2.ucsd.edu/history_legacy/charles_david_keeling_biography.html">Charles David Keeling</a> directed a program to measure the concentrations of CO<sub>2</sub> in the atmosphere that continued without interruption from the late 1950s through the present. This program, operated out of <a href="https://scripps.ucsd.edu">Scripps Institution of Oceanography</a>, is responsible for the Mauna Loa record, which is almost certainly the <strong>best-known icon</strong> illustrating the impact of humanity on the planet as a whole. Learn more about <a href="https://scrippsco2.ucsd.edu/history_legacy/keeling_curve_lessons.html">Keeling Curve Lessons</a>.</p>
<p>We will start with <a href="https://www.esrl.noaa.gov/gmd/ccgg/trends/data.html">monthly CO<sub>2</sub> data</a> measured from Mauna Loa.</p>
<p>To begin with,</p>
<ul>
<li><p>Download the <code>co2_mm_mlo.csv</code> file from <a href="https://zhu-group.github.io/ese335/download/co2_mm_mlo.csv">here</a></p></li>
<li><p>Save the file to your <code>working directory</code>.</p></li>
<li><p>Take a look at the file, where the column <code>co2</code> means monthly average CO<sub>2</sub> in the unit of <code>ppm</code> (part per million, 10<sup>-6</sup>), <code>quality</code> column is the quality flag of the observation, <code>0</code> means the data point does not meet the quality control so that should be discarded, <code>1</code> means the data point is usable.</p></li>
</ul>
<p>Now let’s <em>load</em> this file via the following:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>Keeling_Data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="dt">file =</span> <span class="st">&quot;co2_mm_mlo.csv&quot;</span>, <span class="dt">header =</span> T)</span></code></pre></div>
<p>The file is loaded into the dataset <code>Keeling_Data</code>. Here we use the <em>option</em> <code>header = T</code> so that the first line of <code>co2_mm_mlo.csv</code> is also loaded as names of the variables. You can try to turn this off by setting <code>header = F</code>, and check what happens.</p>
<p>Check the names of columns:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw">colnames</span>(Keeling_Data)</span></code></pre></div>
<pre><code>## [1] &quot;year&quot;         &quot;month&quot;        &quot;decimal_date&quot; &quot;co2&quot;          &quot;quality&quot;</code></pre>
<p>If column names are not specified, <em>e.g.</em>, using <code>headers = FALSE</code> in a <code>read.csv()</code> function, R assigns default names <code>V1</code>, <code>V2</code>, …, <code>Vn</code>.</p>
<p>Check the head (first 6 lines) of the dataset using <code>head()</code> function</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw">head</span>(Keeling_Data)</span></code></pre></div>
<pre><code>##   year  month decimal_date    co2 quality
## 1 1958  March     1958.203 315.70       1
## 2 1958  April     1958.288 317.45       1
## 3 1958    May     1958.370 317.51       1
## 4 1958   June     1958.455 -99.99       0
## 5 1958   July     1958.537 315.86       1
## 6 1958 August     1958.622 314.93       1</code></pre>
<p>Or the end of (last 6 lines) with <code>tail()</code>:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw">tail</span>(Keeling_Data)</span></code></pre></div>
<pre><code>##     year     month decimal_date    co2 quality
## 762 2021    August     2021.625 414.47       1
## 763 2021 September     2021.708 413.30       1
## 764 2021   October     2021.792 413.93       1
## 765 2021  November     2021.875 415.01       1
## 766 2021  December     2021.958 416.71       1
## 767 2022   January     2022.042 418.19       1</code></pre>
<p>The <code>read.table()</code> function is used for reading in <strong>tabular data</strong> stored in a text file where the columns of data are separated by punctuation characters such as <code>.csv</code> files (csv = comma-separated values). Tabular files are the most common <em>file type</em> you would encounter in your future study, as it’s easy to use and share.</p>
<p><code>Tabs</code> and <code>commas</code> are the most common punctuation characters used to separate or delimit data points in <code>.csv</code> files. For convenience R provides 2 other versions of <code>read.table()</code>. These are: <code>read.csv()</code> for files where the data are separated with <code>commas</code> and <code>read.delim()</code> for files where the data are separated with <code>tabs</code>. Of these three functions, <code>read.csv()</code> is the most commonly used. If needed it is possible to override the default delimiting punctuation marks for both <code>read.csv()</code> and <code>read.delim()</code>.</p>
<p>We can begin exploring our data set right away, pulling out columns by specifying them using the <code>$</code> operator:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>Keeling_Data<span class="op">$</span>co2</span></code></pre></div>
<pre><code>##   [1] 315.70 317.45 317.51 -99.99 315.86 314.93 313.20 -99.99 313.33 314.67 315.58 316.48 316.65 317.72 318.29 318.15 316.54 314.80 313.84 313.33 314.81 315.58 316.43 316.98 317.58 319.03
##  [27] 320.04 319.59 318.18 315.90 314.17 313.83 315.00 316.19 316.89 317.70 318.54 319.48 320.58 319.77 318.57 316.79 314.99 315.31 316.10 317.01 317.94 318.55 319.68 320.57 321.02 320.62
##  [53] 319.61 317.40 316.25 315.42 316.69 317.70 318.74 319.07 319.86 321.38 322.25 321.48 319.74 317.77 316.21 315.99 317.07 318.35 319.57 -99.99 -99.99 -99.99 322.26 321.89 320.44 318.69
##  [79] 316.70 316.87 317.68 318.71 319.44 320.44 320.89 322.14 322.17 321.87 321.21 318.87 317.81 317.30 318.87 319.42 320.62 321.60 322.39 323.70 324.08 323.75 322.38 320.36 318.64 318.10
## [105] 319.78 321.03 322.33 322.50 323.04 324.42 325.00 324.09 322.54 320.92 319.25 319.39 320.73 321.96 322.57 323.15 323.89 325.02 325.57 325.36 324.14 322.11 320.33 320.25 321.32 322.89
## [131] 324.00 324.42 325.63 326.66 327.38 326.71 325.88 323.66 322.38 321.78 322.86 324.12 325.06 325.98 326.93 328.13 328.08 327.67 326.34 324.69 323.10 323.06 324.01 325.13 326.17 326.68
## [157] 327.17 327.79 328.93 328.57 327.36 325.43 323.36 323.56 324.80 326.01 326.77 327.63 327.75 329.72 330.07 329.09 328.04 326.32 324.84 325.20 326.50 327.55 328.55 329.56 330.30 331.50
## [183] 332.48 332.07 330.87 329.31 327.51 327.18 328.16 328.64 329.35 330.71 331.48 332.65 333.19 332.20 331.07 329.15 327.33 327.28 328.31 329.58 330.73 331.46 331.94 333.11 333.95 333.42
## [209] 331.97 329.95 328.50 328.36 329.38 -99.99 331.56 332.74 333.36 334.74 334.72 333.98 333.08 330.68 328.96 328.72 330.16 331.62 332.68 333.17 334.96 336.14 336.93 336.17 334.88 332.56
## [235] 331.29 331.28 332.46 333.60 334.94 335.26 336.66 337.69 338.02 338.01 336.50 334.42 332.36 332.45 333.76 334.91 336.14 336.69 338.27 338.82 339.24 339.26 337.54 335.72 333.97 334.24
## [261] 335.32 336.82 337.90 338.34 340.07 340.93 341.45 341.36 339.45 337.67 336.25 336.14 337.30 338.29 339.29 340.55 341.63 342.60 343.04 342.54 340.82 338.48 336.95 337.05 338.57 339.91
## [287] 340.93 341.76 342.78 343.96 344.77 343.88 342.42 340.24 338.38 338.41 339.44 340.78 341.57 342.79 343.37 345.40 346.14 345.76 344.32 342.50 340.46 340.53 341.79 343.20 344.21 344.92
## [313] 345.68 -99.99 347.77 347.16 345.79 343.74 341.59 341.86 343.31 345.00 345.48 346.41 347.91 348.66 349.28 348.65 346.90 345.26 343.47 343.35 344.73 346.12 346.78 347.48 348.25 349.86
## [339] 350.52 349.98 348.25 346.17 345.48 344.82 346.22 347.49 348.73 348.92 349.81 351.40 352.15 351.59 350.21 348.20 346.66 346.72 348.08 349.28 350.51 351.70 352.50 353.67 354.35 353.88
## [365] 352.80 350.49 348.97 349.37 350.43 351.62 353.07 353.43 354.08 355.72 355.95 355.44 354.05 351.84 350.09 350.33 351.55 352.91 353.86 355.10 355.75 356.38 357.38 356.39 354.89 353.07
## [391] 351.38 351.69 353.14 354.41 354.93 355.82 357.33 358.77 359.23 358.23 356.30 353.97 352.34 352.43 353.89 355.21 356.34 357.21 357.97 359.22 359.71 359.43 357.15 354.98 353.01 353.41
## [417] 354.42 355.68 357.10 357.42 358.59 359.39 360.30 359.64 357.46 355.76 354.14 354.23 355.53 357.03 358.36 359.04 360.11 361.36 361.78 360.94 359.51 357.59 355.86 356.21 357.65 359.10
## [443] 360.04 361.00 361.98 363.44 363.83 363.33 361.78 359.33 358.32 358.14 359.61 360.82 362.20 363.36 364.28 364.69 365.25 365.06 363.69 361.55 359.69 359.72 361.04 362.39 363.24 364.21
## [469] 364.65 366.49 366.77 365.73 364.46 362.40 360.44 360.98 362.65 364.51 365.39 366.10 367.36 368.79 369.56 369.13 367.98 366.10 364.16 364.54 365.67 367.30 368.35 369.28 369.84 371.15
## [495] 371.12 370.46 369.61 367.06 364.95 365.52 366.88 368.26 369.45 369.71 370.75 371.98 371.74 371.87 370.02 368.27 367.15 367.18 368.53 369.83 370.76 371.69 372.63 373.55 374.03 373.40
## [521] 371.68 369.78 368.34 368.61 369.94 371.42 372.70 373.37 374.30 375.19 375.93 375.69 374.16 372.03 370.92 370.73 372.43 373.98 375.07 375.82 376.64 377.92 378.78 378.46 376.88 374.57
## [547] 373.34 373.31 374.84 376.17 377.17 378.05 379.06 380.54 380.80 379.87 377.65 376.17 374.43 374.63 376.33 377.68 378.63 379.91 380.95 382.48 382.64 382.40 380.93 378.93 376.89 377.19
## [573] 378.54 380.31 381.58 382.40 382.86 384.80 385.22 384.24 382.65 380.60 379.04 379.33 380.35 382.02 383.10 384.12 384.81 386.73 386.78 386.33 384.73 382.24 381.20 381.37 382.70 384.19
## [599] 385.78 386.06 386.28 387.33 388.78 387.99 386.61 384.32 383.41 383.21 384.41 385.79 387.17 387.70 389.04 389.76 390.36 389.70 388.25 386.29 384.95 384.64 386.23 387.63 388.91 390.41
## [625] 391.37 392.67 393.21 392.38 390.41 388.54 387.03 387.43 388.87 389.99 391.50 392.05 392.80 393.44 394.41 393.95 392.72 390.33 389.28 389.19 390.48 392.06 393.31 394.04 394.59 396.38
## [651] 396.93 395.91 394.56 392.59 391.32 391.27 393.20 394.57 395.78 397.03 397.66 398.64 400.02 398.81 397.51 395.39 393.72 393.90 395.36 397.03 398.04 398.27 399.91 401.51 401.96 401.43
## [677] 399.38 397.32 395.64 396.29 397.55 399.15 400.18 400.55 401.74 403.35 404.15 402.97 401.46 399.11 397.82 398.49 400.27 402.06 402.73 404.25 405.06 407.60 407.90 406.99 404.59 402.45
## [703] 401.23 401.79 403.72 404.64 406.36 406.66 407.53 409.22 409.89 409.08 407.33 405.32 403.57 403.82 405.31 407.00 408.15 408.52 409.59 410.45 411.44 410.99 408.90 407.16 405.71 406.19
## [729] 408.21 409.27 411.03 411.96 412.18 413.54 414.86 414.16 411.97 410.18 408.76 408.75 410.48 411.98 413.61 414.34 414.74 416.45 417.31 416.60 414.62 412.78 411.52 411.51 413.12 414.26
## [755] 415.52 416.75 417.64 419.05 419.13 418.94 416.96 414.47 413.30 413.93 415.01 416.71 418.19</code></pre>
<p>Let’s do some simple statistical checks with <code>Keeling_Data$co2</code>:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># Min</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="kw">min</span>(Keeling_Data<span class="op">$</span>co2)</span></code></pre></div>
<pre><code>## [1] -99.99</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># Max</span></span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="kw">max</span>(Keeling_Data<span class="op">$</span>co2)</span></code></pre></div>
<pre><code>## [1] 419.13</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># Range</span></span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="kw">range</span>(Keeling_Data<span class="op">$</span>co2)</span></code></pre></div>
<pre><code>## [1] -99.99 419.13</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># Mean</span></span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="kw">mean</span>(Keeling_Data<span class="op">$</span>co2)</span></code></pre></div>
<pre><code>## [1] 352.9977</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="co"># Median</span></span>
<span id="cb19-2"><a href="#cb19-2"></a><span class="kw">median</span>(Keeling_Data<span class="op">$</span>co2)</span></code></pre></div>
<pre><code>## [1] 353.86</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="co"># Show quantiles</span></span>
<span id="cb21-2"><a href="#cb21-2"></a><span class="kw">summary</span>(Keeling_Data<span class="op">$</span>co2)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  -99.99  329.33  353.86  353.00  381.07  419.13</code></pre>
<p>You will find there are some <code>-99.99</code> values, which are <em>missing values</em>. We will get back to this later.</p>
<p>You can use <code>[]</code> to extract elements of a vector by specifying their corresponding <em>index</em>.</p>
<p><font size="2" color="red"> <strong>Important: </strong></font> Index in R starts from <code>1</code>, not <code>0</code>. For example:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>Keeling_Data<span class="op">$</span>co2[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]</span></code></pre></div>
<pre><code>##  [1] 315.70 317.45 317.51 -99.99 315.86 314.93 313.20 -99.99 313.33 314.67</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>Keeling_Data<span class="op">$</span>year[<span class="dv">200</span><span class="op">:</span><span class="dv">210</span>]</span></code></pre></div>
<pre><code>##  [1] 1974 1974 1974 1975 1975 1975 1975 1975 1975 1975 1975</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>Keeling_Data<span class="op">$</span>co2[<span class="dv">0</span>]</span></code></pre></div>
<pre><code>## numeric(0)</code></pre>
</div>
<div id="tidy-data" class="section level1">
<h1>Tidy data</h1>
<p>In the rest of the section, we will learn a consistent way to organize the data in R, called <strong>tidy data</strong>. Getting the data into this format requires some upfront work, but that work pays off in the long term. Once you have tidy data and the tools provided by the <code>tidyr</code>, <code>dplyr</code> and <code>ggplot2</code> packages, you will spend much less time munging/wrangling data from one representation to another, allowing you to spend more time on the analytic questions at hand.</p>
<div id="tibble" class="section level2">
<h2>Tibble</h2>
<p>For now, we will use <code>tibble</code> instead of R’s traditional <code>data.frame</code>. Tibble is a data frame, but they tweak some older behaviors to make life a little easier.</p>
<p>Let’s use <code>Keeling_Data</code> again:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a>Keeling_Data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="dt">file =</span> <span class="st">&quot;co2_mm_mlo.csv&quot;</span>, <span class="dt">header =</span> T)</span>
<span id="cb29-2"><a href="#cb29-2"></a><span class="kw">head</span>(Keeling_Data)</span></code></pre></div>
<pre><code>##   year  month decimal_date    co2 quality
## 1 1958  March     1958.203 315.70       1
## 2 1958  April     1958.288 317.45       1
## 3 1958    May     1958.370 317.51       1
## 4 1958   June     1958.455 -99.99       0
## 5 1958   July     1958.537 315.86       1
## 6 1958 August     1958.622 314.93       1</code></pre>
<p>You can coerce a <code>data.frame</code> to a <code>tibble</code> using the <code>as_tibble()</code> function:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a>Keeling_Data_tbl &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(Keeling_Data)</span>
<span id="cb31-2"><a href="#cb31-2"></a>Keeling_Data_tbl</span></code></pre></div>
<pre><code>## # A tibble: 767 x 5
##     year month     decimal_date   co2 quality
##    &lt;int&gt; &lt;chr&gt;            &lt;dbl&gt; &lt;dbl&gt;   &lt;int&gt;
##  1  1958 March            1958.  316.       1
##  2  1958 April            1958.  317.       1
##  3  1958 May              1958.  318.       1
##  4  1958 June             1958. -100.       0
##  5  1958 July             1959.  316.       1
##  6  1958 August           1959.  315.       1
##  7  1958 September        1959.  313.       1
##  8  1958 October          1959. -100.       0
##  9  1958 November         1959.  313.       1
## 10  1958 December         1959.  315.       1
## # ... with 757 more rows</code></pre>
</div>
<div id="tidy-dataset" class="section level2">
<h2>Tidy dataset</h2>
<p>There are three inter-related rules which make a dataset tidy:</p>
<ul>
<li>Each variable must have its own column;</li>
<li>Each observation must have its own row;</li>
<li>Each value must have its own cell;</li>
</ul>
<p>These three rules are interrelated because it’s impossible to only satisfy two of the three.</p>
<p>That interrelationship leads to an even simpler set of practical instructions:</p>
<ul>
<li>Put each dataset in a tibble</li>
<li>Put each variable in a column</li>
</ul>
<p>Why ensure that your data is tidy? There are two main advantages:</p>
<ul>
<li><p>There’s a general advantage to picking one consistent way of storing data. If you have <strong>a consistent data structure</strong>, it’s easier to learn the tools that work with it because they have an <strong>underlying uniformity</strong>. If you ensure that your data is tidy, you’ll spend less time fighting with the tools and more time working on your analysis.</p></li>
<li><p>There’s a specific advantage to placing variables in columns because it allows R’s <strong>vectorized nature</strong> to shine. That makes transforming tidy data feel particularly natural. <code>tidyr</code>, <code>dplyr</code>, and <code>ggplot2</code> are designed to work with tidy data.</p></li>
</ul>
<hr />
</div>
</div>
<div id="the-dplyr-package" class="section level1">
<h1>The <code>dplyr</code> package</h1>
<p>The <code>dplyr</code> package provides a number of very useful functions for manipulating dataframes in a way that will reduce the self-repetition, reduce the probability of making errors, and probably even save you some typing. As an added bonus, you might even find the dplyr grammar easier to read.</p>
<p>Here we’re going to cover commonly used functions as well as using pipes <code>%&gt;%</code> to combine them.</p>
<div id="using-select" class="section level2">
<h2>Using <code>select()</code></h2>
<p>Use the <code>select()</code> function to keep only the variables (columns) you select.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a>dplyr<span class="op">::</span><span class="kw">select</span>(Keeling_Data_tbl,year,co2,quality)</span></code></pre></div>
<pre><code>## # A tibble: 767 x 3
##     year   co2 quality
##    &lt;int&gt; &lt;dbl&gt;   &lt;int&gt;
##  1  1958  316.       1
##  2  1958  317.       1
##  3  1958  318.       1
##  4  1958 -100.       0
##  5  1958  316.       1
##  6  1958  315.       1
##  7  1958  313.       1
##  8  1958 -100.       0
##  9  1958  313.       1
## 10  1958  315.       1
## # ... with 757 more rows</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a>dplyr<span class="op">::</span><span class="kw">select</span>(Keeling_Data_tbl,co2)</span></code></pre></div>
<pre><code>## # A tibble: 767 x 1
##      co2
##    &lt;dbl&gt;
##  1  316.
##  2  317.
##  3  318.
##  4 -100.
##  5  316.
##  6  315.
##  7  313.
##  8 -100.
##  9  313.
## 10  315.
## # ... with 757 more rows</code></pre>
</div>
<div id="the-pipe-symbol" class="section level2">
<h2>The pipe symbol <code>%&gt;%</code></h2>
<p>Above we used ‘normal’ grammar, but the strengths of <code>dplyr</code> and <code>tidyr</code> lie in combining several functions using <strong>pipes</strong>. Since the pipes grammar is unlike anything we’ve seen in R before, let’s repeat what we’ve done above using pipes.</p>
<p><code>x %&gt;% f(y)</code> is the same as <code>f(x, y)</code></p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a>Keeling_Data_tbl <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb37-2"><a href="#cb37-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(year,co2,quality)</span></code></pre></div>
<pre><code>## # A tibble: 767 x 3
##     year   co2 quality
##    &lt;int&gt; &lt;dbl&gt;   &lt;int&gt;
##  1  1958  316.       1
##  2  1958  317.       1
##  3  1958  318.       1
##  4  1958 -100.       0
##  5  1958  316.       1
##  6  1958  315.       1
##  7  1958  313.       1
##  8  1958 -100.       0
##  9  1958  313.       1
## 10  1958  315.       1
## # ... with 757 more rows</code></pre>
<p>The above lines mean we first call the <code>Keeling_Data_tbl</code> tibble and pass it on, using the <strong>pipe symbol</strong> <code>%&gt;%</code>, to the next step, which is the <code>select()</code> function. In this case, we don’t specify which <strong>data object</strong> we use in the <code>select()</code> function since in gets that from the previous pipe. The <code>select()</code> function then takes what it gets from the pipe, in this case the <code>Keeling_Data_tbl</code> tibble, as its <strong>first argument</strong>. By using pipe, we can take output of the previous step as input for the next one, so that we can avoid defining and calling unnecessary temporary variables. You will start to see the power of pipe later.</p>
</div>
<div id="using-filter" class="section level2">
<h2>Using <code>filter()</code></h2>
<p>Use <code>filter()</code> to get values (rows):</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a>Keeling_Data_tbl <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb39-2"><a href="#cb39-2"></a><span class="st">  </span><span class="kw">filter</span>(year <span class="op">==</span><span class="st"> </span><span class="dv">2000</span>)</span></code></pre></div>
<pre><code>## # A tibble: 12 x 5
##     year month     decimal_date   co2 quality
##    &lt;int&gt; &lt;chr&gt;            &lt;dbl&gt; &lt;dbl&gt;   &lt;int&gt;
##  1  2000 January          2000.  369.       1
##  2  2000 February         2000.  370.       1
##  3  2000 March            2000.  371.       1
##  4  2000 April            2000.  372.       1
##  5  2000 May              2000.  372.       1
##  6  2000 June             2000.  372.       1
##  7  2000 July             2001.  370.       1
##  8  2000 August           2001.  368.       1
##  9  2000 September        2001.  367.       1
## 10  2000 October          2001.  367.       1
## 11  2000 November         2001.  369.       1
## 12  2000 December         2001.  370.       1</code></pre>
<p>If we now want to move forward with the above tibble, but only with <code>quality == 1</code> , we can combine <code>select()</code> and <code>filter()</code> functions:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a>Keeling_Data_tbl <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb41-2"><a href="#cb41-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(year,co2,quality) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb41-3"><a href="#cb41-3"></a><span class="st">  </span><span class="kw">filter</span>(quality <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>## # A tibble: 760 x 3
##     year   co2 quality
##    &lt;int&gt; &lt;dbl&gt;   &lt;int&gt;
##  1  1958  316.       1
##  2  1958  317.       1
##  3  1958  318.       1
##  4  1958  316.       1
##  5  1958  315.       1
##  6  1958  313.       1
##  7  1958  313.       1
##  8  1958  315.       1
##  9  1959  316.       1
## 10  1959  316.       1
## # ... with 750 more rows</code></pre>
<p>You see here we have used the pipe twice, and the scripts become really clean and easy to follow.</p>
</div>
<div id="using-group_by-and-summarize" class="section level2">
<h2>Using <code>group_by()</code> and <code>summarize()</code></h2>
<p>Now try to group monthly data using the <code>group_by()</code> function, notice how the output tibble changes:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a>Keeling_Data_tbl <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb43-2"><a href="#cb43-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(year,month,co2,quality) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb43-3"><a href="#cb43-3"></a><span class="st">  </span><span class="kw">filter</span>(quality <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb43-4"><a href="#cb43-4"></a><span class="st">  </span><span class="kw">group_by</span>(month)</span></code></pre></div>
<pre><code>## # A tibble: 760 x 4
## # Groups:   month [12]
##     year month       co2 quality
##    &lt;int&gt; &lt;chr&gt;     &lt;dbl&gt;   &lt;int&gt;
##  1  1958 March      316.       1
##  2  1958 April      317.       1
##  3  1958 May        318.       1
##  4  1958 July       316.       1
##  5  1958 August     315.       1
##  6  1958 September  313.       1
##  7  1958 November   313.       1
##  8  1958 December   315.       1
##  9  1959 January    316.       1
## 10  1959 February   316.       1
## # ... with 750 more rows</code></pre>
<p>The <code>group_by()</code> function is much more exciting in conjunction with the <code>summarize()</code> function. This will allow us to create new variable(s) by using functions that repeat for each of the continent-specific data frames. That is to say, using the <code>group_by()</code> function, we <strong>split our original dataframe into multiple pieces</strong>, then we can run functions (<em>e.g.</em>, <code>mean()</code> or <code>sd()</code>) within <code>summarize()</code>.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a>Keeling_Data_tbl <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb45-2"><a href="#cb45-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(year,month,co2,quality) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb45-3"><a href="#cb45-3"></a><span class="st">  </span><span class="kw">filter</span>(quality <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb45-4"><a href="#cb45-4"></a><span class="st">  </span><span class="kw">group_by</span>(month) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb45-5"><a href="#cb45-5"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">monthly_mean =</span> <span class="kw">mean</span>(co2))</span></code></pre></div>
<pre><code>## # A tibble: 12 x 2
##    month     monthly_mean
##    &lt;chr&gt;            &lt;dbl&gt;
##  1 April             360.
##  2 August            355.
##  3 December          357.
##  4 February          358.
##  5 January           358.
##  6 July              357.
##  7 June              360.
##  8 March             358.
##  9 May               360.
## 10 November          355.
## 11 October           355.
## 12 September         354.</code></pre>
<p>Here we create a new variable (column) <code>monthly_mean</code>, and append it to the groups (<code>month</code> in this case). Now, we get a so-called <em>monthly climatology</em>.</p>
<p>You can also use <code>arrange()</code> and <code>desc()</code> to sort the data:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a>Keeling_Data_tbl <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb47-2"><a href="#cb47-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(year,month,co2,quality) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb47-3"><a href="#cb47-3"></a><span class="st">  </span><span class="kw">filter</span>(quality <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb47-4"><a href="#cb47-4"></a><span class="st">  </span><span class="kw">group_by</span>(month) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb47-5"><a href="#cb47-5"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">monthly_mean =</span> <span class="kw">mean</span>(co2)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb47-6"><a href="#cb47-6"></a><span class="st">  </span><span class="kw">arrange</span>(monthly_mean)</span></code></pre></div>
<pre><code>## # A tibble: 12 x 2
##    month     monthly_mean
##    &lt;chr&gt;            &lt;dbl&gt;
##  1 September         354.
##  2 October           355.
##  3 November          355.
##  4 August            355.
##  5 December          357.
##  6 July              357.
##  7 January           358.
##  8 February          358.
##  9 March             358.
## 10 May               360.
## 11 June              360.
## 12 April             360.</code></pre>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a>Keeling_Data_tbl <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb49-2"><a href="#cb49-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(year,month,co2,quality) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb49-3"><a href="#cb49-3"></a><span class="st">  </span><span class="kw">filter</span>(quality <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb49-4"><a href="#cb49-4"></a><span class="st">  </span><span class="kw">group_by</span>(month) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb49-5"><a href="#cb49-5"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">monthly_mean =</span> <span class="kw">mean</span>(co2)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb49-6"><a href="#cb49-6"></a><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(monthly_mean))</span></code></pre></div>
<pre><code>## # A tibble: 12 x 2
##    month     monthly_mean
##    &lt;chr&gt;            &lt;dbl&gt;
##  1 April             360.
##  2 June              360.
##  3 May               360.
##  4 March             358.
##  5 February          358.
##  6 January           358.
##  7 July              357.
##  8 December          357.
##  9 August            355.
## 10 November          355.
## 11 October           355.
## 12 September         354.</code></pre>
<p>Let’s add more statistics to the monthly climatology:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a>Keeling_Data_tbl <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb51-2"><a href="#cb51-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(year,month,co2,quality) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb51-3"><a href="#cb51-3"></a><span class="st">  </span><span class="kw">filter</span>(quality <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb51-4"><a href="#cb51-4"></a><span class="st">  </span><span class="kw">group_by</span>(month) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb51-5"><a href="#cb51-5"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">monthly_mean =</span> <span class="kw">mean</span>(co2), <span class="dt">monthly_sd =</span> <span class="kw">sd</span>(co2),</span>
<span id="cb51-6"><a href="#cb51-6"></a>            <span class="dt">monthly_min =</span> <span class="kw">min</span>(co2), <span class="dt">monthly_max =</span> <span class="kw">max</span>(co2),</span>
<span id="cb51-7"><a href="#cb51-7"></a>            <span class="dt">monthly_se =</span> <span class="kw">sd</span>(co2)<span class="op">/</span><span class="kw">sqrt</span>(<span class="kw">n</span>()))</span></code></pre></div>
<pre><code>## # A tibble: 12 x 6
##    month     monthly_mean monthly_sd monthly_min monthly_max monthly_se
##    &lt;chr&gt;            &lt;dbl&gt;      &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;      &lt;dbl&gt;
##  1 April             360.       30.2        317.        419.       3.84
##  2 August            355.       29.8        315.        414.       3.73
##  3 December          357.       30.4        315.        417.       3.84
##  4 February          358.       29.7        316.        417.       3.77
##  5 January           358.       30.5        316.        418.       3.81
##  6 July              357.       29.9        316.        417.       3.74
##  7 June              360.       29.9        318.        419.       3.76
##  8 March             358.       29.9        316.        418.       3.77
##  9 May               360.       30.2        318.        419.       3.77
## 10 November          355.       30.3        313.        415.       3.78
## 11 October           355.       29.9        313.        414.       3.77
## 12 September         354.       29.9        313.        413.       3.74</code></pre>
<p>Here we call the <code>n()</code> to get the size of a vector.</p>
</div>
<div id="using-mutate" class="section level2">
<h2>Using <code>mutate()</code></h2>
<p>We can also create new variables (columns) using the <code>mutate()</code> function. Here we create a new column <code>co2_ppb</code> by simply scaling <code>co2</code> by a factor of <code>1000</code>.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a>Keeling_Data_tbl <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb53-2"><a href="#cb53-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">co2_ppb =</span> co2 <span class="op">*</span><span class="st"> </span><span class="fl">1e3</span>)</span></code></pre></div>
<pre><code>## # A tibble: 767 x 6
##     year month     decimal_date   co2 quality co2_ppb
##    &lt;int&gt; &lt;chr&gt;            &lt;dbl&gt; &lt;dbl&gt;   &lt;int&gt;   &lt;dbl&gt;
##  1  1958 March            1958.  316.       1  315700
##  2  1958 April            1958.  317.       1  317450
##  3  1958 May              1958.  318.       1  317510
##  4  1958 June             1958. -100.       0  -99990
##  5  1958 July             1959.  316.       1  315860
##  6  1958 August           1959.  315.       1  314930
##  7  1958 September        1959.  313.       1  313200
##  8  1958 October          1959. -100.       0  -99990
##  9  1958 November         1959.  313.       1  313330
## 10  1958 December         1959.  315.       1  314670
## # ... with 757 more rows</code></pre>
<p>When creating new variables, we can hook this with a logical condition. A simple combination of <code>mutate()</code> and <code>ifelse()</code> facilitates filtering right where it is needed: in the moment of creating something new. This easy-to-read statement is a fast and powerful way of discarding certain data or for updating values depending on this given condition.</p>
<p>Let’s create a new variable <code>co2_new</code>, it is equal to <code>co2</code> when <code>quality==1</code>, otherwise it’s <code>NA</code>:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a>Keeling_Data_tbl <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb55-2"><a href="#cb55-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">co2_ppb =</span> co2 <span class="op">*</span><span class="st"> </span><span class="fl">1e3</span>, <span class="dt">co2_new =</span> <span class="kw">ifelse</span>(quality<span class="op">==</span><span class="dv">1</span>, co2, <span class="ot">NA</span>))</span></code></pre></div>
<pre><code>## # A tibble: 767 x 7
##     year month     decimal_date   co2 quality co2_ppb co2_new
##    &lt;int&gt; &lt;chr&gt;            &lt;dbl&gt; &lt;dbl&gt;   &lt;int&gt;   &lt;dbl&gt;   &lt;dbl&gt;
##  1  1958 March            1958.  316.       1  315700    316.
##  2  1958 April            1958.  317.       1  317450    317.
##  3  1958 May              1958.  318.       1  317510    318.
##  4  1958 June             1958. -100.       0  -99990     NA 
##  5  1958 July             1959.  316.       1  315860    316.
##  6  1958 August           1959.  315.       1  314930    315.
##  7  1958 September        1959.  313.       1  313200    313.
##  8  1958 October          1959. -100.       0  -99990     NA 
##  9  1958 November         1959.  313.       1  313330    313.
## 10  1958 December         1959.  315.       1  314670    315.
## # ... with 757 more rows</code></pre>
</div>
<div id="combining-dplyr-and-ggplot2" class="section level2">
<h2>Combining <code>dplyr</code> and <code>ggplot2</code></h2>
<p>Just as we used <code>%&gt;%</code> to pipe data along a chain of <code>dplyr</code> functions we can use it to pass data to <code>ggplot()</code>. Because <code>%&gt;%</code> replaces <strong>the first argument</strong> in a function we don’t need to specify the <code>data = argument</code> in the <code>ggplot()</code> function.</p>
<p>By combining <code>dplyr</code> and <code>ggplot2</code> functions, we can make figures without creating any new variables or modifying the data.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a>Keeling_Data_tbl <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb57-2"><a href="#cb57-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">co2_new =</span> <span class="kw">ifelse</span>(quality<span class="op">==</span><span class="dv">1</span>, co2, <span class="ot">NA</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb57-3"><a href="#cb57-3"></a><span class="st">  </span><span class="co"># Make the plot</span></span>
<span id="cb57-4"><a href="#cb57-4"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>decimal_date, <span class="dt">y=</span>co2_new)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb57-5"><a href="#cb57-5"></a><span class="st">  </span><span class="kw">geom_line</span>()</span></code></pre></div>
<p><img src="S02_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<p>Let’s plot CO<sub>2</sub> of the same month as a function of <code>decimal_date</code>, with the <code>color</code> option:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1"></a>Keeling_Data_tbl <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb58-2"><a href="#cb58-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">co2_new =</span> <span class="kw">ifelse</span>(quality<span class="op">==</span><span class="dv">1</span>, co2, <span class="ot">NA</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb58-3"><a href="#cb58-3"></a><span class="st">  </span><span class="co"># Make the plot</span></span>
<span id="cb58-4"><a href="#cb58-4"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>decimal_date, <span class="dt">y=</span>co2_new, <span class="dt">color=</span>month)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb58-5"><a href="#cb58-5"></a><span class="st">  </span><span class="kw">geom_line</span>()</span></code></pre></div>
<pre><code>## Warning: Removed 2 row(s) containing missing values (geom_path).</code></pre>
<p><img src="S02_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<p>Or plot the same data but in panels (facets), with the <code>facet_wrap</code> function:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1"></a>Keeling_Data_tbl <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb60-2"><a href="#cb60-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">co2_new =</span> <span class="kw">ifelse</span>(quality<span class="op">==</span><span class="dv">1</span>, co2, <span class="ot">NA</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb60-3"><a href="#cb60-3"></a><span class="st">  </span><span class="co"># Make the plot</span></span>
<span id="cb60-4"><a href="#cb60-4"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>decimal_date, <span class="dt">y=</span>co2_new, <span class="dt">color=</span>month)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb60-5"><a href="#cb60-5"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb60-6"><a href="#cb60-6"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>month)</span></code></pre></div>
<pre><code>## Warning: Removed 2 row(s) containing missing values (geom_path).</code></pre>
<p><img src="S02_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<p>OK, that is enough for data wrangling We will learn more about <code>ggplot2</code> in future sections.</p>
<hr />
</div>
</div>
<div id="quick-plots" class="section level1">
<h1>Quick plots</h1>
<p>Now think about what will you do when get a new dataset before analyzing it?</p>
<p>Normally, we would like to do two things - to take a quick look at the statics and to plot the patterns.</p>
<p>R has many built-in functions for a large number of summary statistics. For example, <code>mean()</code>, <code>median()</code>, <code>range()</code>, <code>max()</code>, <code>min()</code>, <code>sd()</code>, <code>var()</code>, <code>IQR()</code>, and <code>summary()</code>. Make sure you understand how to use them and always pay attentions to <code>NA</code> values.</p>
<p>Our next task is to visualize the data. Often, a proper visualization can illuminate features of the data that can inform further analysis. We will learn three basic types of plots in this section.</p>
<div id="histograms" class="section level2">
<h2>Histograms</h2>
<p>When visualizing a single numerical variable, a histogram will be our go-to tool, which can be created in R using the <code>hist()</code> function.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1"></a><span class="co"># Add a new column to the original tibble</span></span>
<span id="cb62-2"><a href="#cb62-2"></a>Keeling_Data_tbl &lt;-<span class="st"> </span>Keeling_Data_tbl <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb62-3"><a href="#cb62-3"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">co2_new =</span> <span class="kw">ifelse</span>(quality<span class="op">==</span><span class="dv">1</span>, co2, <span class="ot">NA</span>))</span>
<span id="cb62-4"><a href="#cb62-4"></a></span>
<span id="cb62-5"><a href="#cb62-5"></a><span class="co"># Notice we use pull() to get a vector from a tibble</span></span>
<span id="cb62-6"><a href="#cb62-6"></a>Month_CO2 &lt;-<span class="st"> </span>Keeling_Data_tbl <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb62-7"><a href="#cb62-7"></a><span class="st">  </span><span class="kw">pull</span>(co2_new)</span>
<span id="cb62-8"><a href="#cb62-8"></a></span>
<span id="cb62-9"><a href="#cb62-9"></a><span class="co"># plot hist</span></span>
<span id="cb62-10"><a href="#cb62-10"></a><span class="kw">hist</span>(Month_CO2)</span></code></pre></div>
<p><img src="S02_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<p>The histogram function has a number of parameters which can be changed to make our plot look much nicer. Use the <code>?</code> operator to read the documentation for the <code>hist()</code> to see a full list of these parameters.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a><span class="kw">hist</span>(Month_CO2,</span>
<span id="cb63-2"><a href="#cb63-2"></a>     <span class="dt">xlab =</span> <span class="st">&quot;Monthly CO2 mixing ratios (ppm)&quot;</span>,</span>
<span id="cb63-3"><a href="#cb63-3"></a>     <span class="dt">main =</span> <span class="st">&quot;Histogram of Monthly CO2&quot;</span>,</span>
<span id="cb63-4"><a href="#cb63-4"></a>     <span class="dt">breaks =</span> <span class="dv">20</span>,</span>
<span id="cb63-5"><a href="#cb63-5"></a>     <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>,</span>
<span id="cb63-6"><a href="#cb63-6"></a>     <span class="dt">border =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb63-7"><a href="#cb63-7"></a><span class="kw">box</span>(<span class="dt">lwd=</span><span class="dv">2</span>,<span class="dt">col=</span><span class="st">&quot;green&quot;</span>)</span></code></pre></div>
<p><img src="S02_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<p>By default R will attempt to intelligently guess a good number of <code>breaks</code>, but as we can see here, it is sometimes useful to modify this yourself.</p>
</div>
<div id="boxplots" class="section level2">
<h2>Boxplots</h2>
<p>To visualize the relationship between a numerical and categorical variable, we will use a <code>boxplot</code>. A boxplot is usful in checking the center, spread, and skewness of a sample.</p>
<p>In the <code>Keeling_Data_tbl</code> dataset, the <code>month</code> is a categorical variable. First, note that we can use a single boxplot as an alternative to a histogram for visualizing a single numerical variable. To do so in R, we use the <code>boxplot()</code> function.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1"></a><span class="kw">boxplot</span>(Month_CO2)</span></code></pre></div>
<p><img src="S02_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<p>Or try to plot the raw data:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1"></a><span class="kw">boxplot</span>(Keeling_Data<span class="op">$</span>co2)</span></code></pre></div>
<p><img src="S02_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<p>However, more often, we will use boxplots to compare a numerical variable for different values of a categorical variable.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1"></a><span class="kw">boxplot</span>(co2_new <span class="op">~</span><span class="st"> </span>month, <span class="dt">data=</span>Keeling_Data_tbl)</span></code></pre></div>
<p><img src="S02_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<p>Here we used the <code>boxplot()</code> command to create side-by-side boxplots. However, since we are now dealing with two variables, the syntax has changed. The R syntax <code>co2_new ~ month, data = Keeling_Data_tbl</code> reads “Plot the <code>co2_new</code> variable against the <code>month</code> variable using the <code>Keeling_Data_tbl</code> dataset.” We see the use of a <code>~</code> (which specifies a formula) and also a <code>data = argument</code>. This will be a syntax that is common to many functions we will use later.</p>
<p>Again, <code>boxplot()</code> has a number of additional arguments which have the ability to make our plot more visually appealing.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1"></a><span class="kw">boxplot</span>(co2_new <span class="op">~</span><span class="st"> </span>month, <span class="dt">data=</span>Keeling_Data_tbl,</span>
<span id="cb67-2"><a href="#cb67-2"></a><span class="dt">xlab =</span> <span class="st">&quot;Month&quot;</span>,</span>
<span id="cb67-3"><a href="#cb67-3"></a><span class="dt">ylab =</span> <span class="st">&quot;CO2 (ppm)&quot;</span>,</span>
<span id="cb67-4"><a href="#cb67-4"></a><span class="dt">main =</span> <span class="st">&quot;Monthly CO2&quot;</span>,</span>
<span id="cb67-5"><a href="#cb67-5"></a><span class="dt">cex =</span> <span class="dv">2</span>,</span>
<span id="cb67-6"><a href="#cb67-6"></a><span class="dt">col =</span> <span class="st">&quot;orange&quot;</span>,</span>
<span id="cb67-7"><a href="#cb67-7"></a><span class="dt">border =</span> <span class="st">&quot;darkgreen&quot;</span>)</span></code></pre></div>
<p><img src="S02_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
</div>
<div id="scatterplots" class="section level2">
<h2>Scatterplots</h2>
<p>Lastly, to visualize the relationship between two numeric variables, we will use a scatterplot. This can be done with the <code>plot()</code> function and the <code>~</code> syntax we just used with a boxplot. (The function <code>plot()</code> can also be used more generally; see the documentation for details.)</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1"></a><span class="kw">plot</span>(co2_new <span class="op">~</span><span class="st"> </span>year, <span class="dt">data=</span>Keeling_Data_tbl)</span></code></pre></div>
<p><img src="S02_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1"></a><span class="kw">plot</span>(co2_new <span class="op">~</span><span class="st"> </span>year, <span class="dt">data=</span>Keeling_Data_tbl,</span>
<span id="cb69-2"><a href="#cb69-2"></a><span class="dt">xlab =</span> <span class="st">&quot;Year&quot;</span>,</span>
<span id="cb69-3"><a href="#cb69-3"></a><span class="dt">ylab =</span> <span class="st">&quot;CO2 (ppm)&quot;</span>,</span>
<span id="cb69-4"><a href="#cb69-4"></a><span class="dt">main =</span> <span class="st">&quot;CO2 vs Year&quot;</span>,</span>
<span id="cb69-5"><a href="#cb69-5"></a><span class="dt">pch =</span> <span class="st">&quot;+&quot;</span>,</span>
<span id="cb69-6"><a href="#cb69-6"></a><span class="dt">cex =</span> <span class="dv">2</span>,</span>
<span id="cb69-7"><a href="#cb69-7"></a><span class="dt">col =</span> <span class="st">&quot;navy&quot;</span>)</span></code></pre></div>
<p><img src="S02_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
<hr />
</div>
</div>
<div id="in-class-exercises" class="section level1">
<h1>In-class exercises</h1>
<div id="exercise-1" class="section level2">
<h2>Exercise #1</h2>
<p>Use <code>Keeling_Data</code>, compute the annual mean of CO<sub>2</sub> since 1959, plot your results.</p>
<hr />
</div>
</div>
<div id="further-reading" class="section level1">
<h1>Further reading</h1>
<ul>
<li><a href="https://rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">Data Wrangling with dplyr and tidyr Cheat Sheet</a></li>
<li><a href="http://swcarpentry.github.io/r-novice-gapminder/13-dplyr/index.html">Dataframe Manipulation with dplyr</a></li>
<li><a href="http://swcarpentry.github.io/r-novice-gapminder/14-tidyr/index.html">Dataframe Manipulation with tidyr</a></li>
<li><a href="https://r4ds.had.co.nz/">R for Data Science</a>, see chapter 10 and 12.</li>
<li><a href="https://rstudio.com/resources/webinars/data-wrangling-with-r-and-rstudio/">Data wrangling with R</a>, with a video</li>
</ul>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = false;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
