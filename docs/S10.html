<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Section 10 One-way ANOVA</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 66px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h2 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h3 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h4 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h5 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h6 {
  padding-top: 71px;
  margin-top: -71px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Environmental Data Analysis</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="Syllabus.html">
    <span class="fa fa-bell-o"></span>
     
    Syllabus
  </a>
</li>
<li>
  <a href="Schedule.html">
    <span class="fa fa-calendar"></span>
     
    Schedule
  </a>
</li>
<li>
  <a href="Resource.html">
    <span class="fa fa-wrench"></span>
     
    Resource
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-laptop"></span>
     
    Assignments
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="A01.html">Assignment 01</a>
    </li>
    <li>
      <a href="A02.html">Assignment 02</a>
    </li>
    <li>
      <a href="A03.html">Assignment 03</a>
    </li>
    <li>
      <a href="A04.html">Assignment 04</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Section 10 One-way ANOVA</h1>

</div>


<hr />
<div id="prerequisites" class="section level1">
<h1>Prerequisites</h1>
<p>Load the libraries with R:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(ggplot2)</span></code></pre></div>
<hr />
</div>
<div id="section-example-removal-of-cadmium-from-soil-by-plants" class="section level1">
<h1>Section Example: Removal of cadmium from soil by plants</h1>
<p>Cadmium (Cd) has been identified as the priority control metal in China due to its higher concentrations in soil and higher health risks posed to the public. (Chen et al., Contamination features and health risk of soil heavy metals in China, <em>Science of The Total Environment</em>, 512–513, p.143-153, 2015).</p>
<p>Plants are able to remove soil Cd via the uptaking of the root. To test the impact of different plants on Cd removal, a researcher measured Cd concentrations (mg/kg) under <code>4</code> conditions. For each condition/group, soil Cd was independently measured several times.</p>
<ul>
<li><p>Control: <code>0.64, 0.91, 0.84, 0.41, 1.58, 0.48, 0.88, 0.74, 1.09, 1.28</code></p></li>
<li><p>With plant #1: <code>1.20, 1.17, 0.76, 0.92, 0.65, 1.14, 1.05, 1.28, 0.89, 1.06</code></p></li>
<li><p>With plant #2: <code>0.25, 1.31, 0.43, 1.18, 1.02, 0.83, 1.02, 0.66, 0.70, 0.83</code></p></li>
<li><p>With plant #3: <code>0.63, 0.30, 0.49, 0.01, 0.63, 0.69, 0.68, 0.34, 1.09, 0.42</code></p></li>
</ul>
<p>Here are the side-by-side boxplots:</p>
<p><img src="figs/Cd_boxplots.png" alt="drawing" width="650"/></p>
<p>Do soil Cd concentrations differ under the four conditions? Or do different plants influence soil Cd concentration differently? How to test this? Can we use the t-tools from previous sections?</p>
<hr />
</div>
<div id="one-way-anova-basics" class="section level1">
<h1>One-way ANOVA basics</h1>
<p><em>Analysis of variance</em> (ANOVA) is one of the most frequently used techniques in the environmental sciences. ANOVA is used to contrast a continuous dependent variable (e.g., soil Cd concentrations) across <em>levels</em> of one or more categorical independent variables (also called <em>factors</em>). In the section example, there is only one categorical independent variable that has <code>4</code> levels (control, plant #1, plant #2, and plant #3). For ANOVA dealing with only one factor, it is called one-way ANOVA or one-factor ANOVA.</p>
<p>One-way ANOVA is similar to the two samples t-test. The later one is used for comparison of population means across <strong>two levels</strong>, while one-way ANOVA is used for the comparison of population means across <strong>more than two levels</strong> (note that, the levels are determined by only one factor). The logic of ANOVA is essentially the same as the t-test - it compares variability between groups to variability within groups to determine whether the observed differences are due to chance or not.</p>
<div id="variation-between-and-within-groups" class="section level2">
<h2>Variation between and within groups</h2>
<p>Suppose there are <span class="math inline">\(M\)</span> levels of observations in the sample <span class="math inline">\(X\)</span>, so we have <span class="math inline">\(X=\{ X_1, X_2, \dots, X_M \}\)</span>. For each level <span class="math inline">\(m\)</span> (<span class="math inline">\(m=1,2,\dots,M\)</span>), the sample size of corresponding sub-sample <span class="math inline">\(X_m\)</span> is <span class="math inline">\(n_m\)</span>. Let’s use <span class="math inline">\(N\)</span> to denote the overall sample size of <span class="math inline">\(X\)</span>, so <span class="math inline">\(N=n_1+n_2+\dots+n_M\)</span>.</p>
<p>The <strong>total variability</strong> of the variable can be measured by the sum of squares total (SS<sub>T</sub>), given by:</p>
<p><span class="math display">\[SS_T = \sum_{i=1}^{N}(x_i-\overline X)^2\]</span> where <span class="math inline">\(x_i\)</span> corresponds to the <em>i</em><sup>th</sup> observation of <span class="math inline">\(X\)</span> and <span class="math inline">\(\overline X\)</span> to the overall mean of <span class="math inline">\(X\)</span>.</p>
<p>The sum of squares between groups (SS<sub>B</sub>) is a measure for the <strong>variability between groups</strong>. SS<sub>B</sub> corresponds to the SD of group means (<span class="math inline">\(\overline X_m\)</span>) from the overall mean (<span class="math inline">\(\overline X\)</span>), weighted by the sample size (<span class="math inline">\(n_m\)</span>).</p>
<p><span class="math display">\[SS_B = \sum_{m=1}^{M}[n_m(\overline {X_m}-\overline X)^2]\]</span></p>
<p>Finally, the sum of squares within groups (SS<sub>W</sub>) is a measure for the <strong>variability within groups</strong>. SS<sub>W</sub> is associated with the variability that cannot be explained by the group variable.</p>
<p><span class="math display">\[SS_W = \sum_{m=1}^{M} \sum_{k=1}^{n_m}(x_k-\overline {X_m})^2\]</span> where <span class="math inline">\(x_k\)</span> corresponds to the <em>k</em><sup>th</sup> observation of the sub-sample <span class="math inline">\(X_m\)</span>, and <span class="math inline">\(k=1,2,\dots,n_m\)</span>.</p>
<p>One can easily prove that:</p>
<p><span class="math display">\[SS_T = SS_B + SS_W\]</span></p>
</div>
<div id="measures-of-mean-variability" class="section level2">
<h2>Measures of mean variability</h2>
<p>To get an average variability, we scale the above measures of variability by the degrees of freedom. The degrees of freedom are defined for each partition of variability (SS<sub>T</sub>, SS<sub>B</sub>, and SS<sub>W</sub>).</p>
<p>For the total variability (SS<sub>T</sub>):</p>
<p><span class="math inline">\(df_T=N-1\)</span></p>
<p>For the variability between groups (SS<sub>B</sub>):</p>
<p><span class="math inline">\(df_B=M-1\)</span></p>
<p>For the variability within groups (SS<sub>W</sub>):</p>
<p><span class="math inline">\(df_W=N-M\)</span></p>
<p>The mean variability between groups (MS<sub>B</sub>) is:</p>
<p><span class="math inline">\(MS_B=\frac {SS_B} {df_B}\)</span></p>
<p>And the mean variability within groups (MS<sub>W</sub>) is:</p>
<p><span class="math inline">\(MS_W=\frac {SS_W} {df_W}\)</span></p>
</div>
<div id="f-statistic" class="section level2">
<h2><em>F</em> statistic</h2>
<p>Finally, we compare the mean variation between the groups, MS<sub>B</sub>, to the variation within the groups, MS<sub>W</sub>, by calculating the ratio between the two (denoted as <em>F</em>).</p>
<p><span class="math inline">\(F=\frac {MS_B} {MS_W}\)</span></p>
<p>The <em>F</em>-statistic follows the <strong>F-distribution</strong> (named after Ronald A. Fisher) with a two degrees of freedom <span class="math inline">\(df(M-1,N-M)\)</span>:</p>
<p><span class="math inline">\(F=\frac {MS_B} {MS_W} \sim F_{df=(M-1,N-M)}\)</span></p>
</div>
<div id="f-distribution" class="section level2">
<h2><em>F</em>-distribution</h2>
<p>With R, we can easily plot PDFs from different <em>F</em>-distributions with the <code>df()</code> function.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># Make a vector from 0 to 5, with a step of 0.01 </span></span>
<span id="cb2-2"><a href="#cb2-2"></a>x        &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">5.0</span>, <span class="dt">by=</span><span class="fl">0.01</span>)</span>
<span id="cb2-3"><a href="#cb2-3"></a></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="co"># Get the density for each element in x</span></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="co"># Set the degrees of freedom to be (2,2)</span></span>
<span id="cb2-6"><a href="#cb2-6"></a>density1 &lt;-<span class="st"> </span><span class="kw">df</span>(x, <span class="dt">df1=</span><span class="dv">2</span>, <span class="dt">df2=</span><span class="dv">2</span>)</span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="co"># Plot Density</span></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="kw">plot</span>(x, density1, <span class="dt">col=</span><span class="st">&quot;black&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Density&quot;</span>, </span>
<span id="cb2-9"><a href="#cb2-9"></a>     <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">cex=</span><span class="dv">2</span>, </span>
<span id="cb2-10"><a href="#cb2-10"></a>     <span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">5.0</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="fl">1.2</span>),</span>
<span id="cb2-11"><a href="#cb2-11"></a>     <span class="dt">main=</span><span class="st">&quot;PDF of F distributions&quot;</span>)</span>
<span id="cb2-12"><a href="#cb2-12"></a></span>
<span id="cb2-13"><a href="#cb2-13"></a><span class="co"># Get and plot the density from another F distribution</span></span>
<span id="cb2-14"><a href="#cb2-14"></a><span class="co"># Set the degrees of freedom to be (2,30)</span></span>
<span id="cb2-15"><a href="#cb2-15"></a>density2 &lt;-<span class="st"> </span><span class="kw">df</span>(x, <span class="dt">df1=</span><span class="dv">2</span>, <span class="dt">df2=</span><span class="dv">30</span>)</span>
<span id="cb2-16"><a href="#cb2-16"></a><span class="kw">lines</span>(x, density2, <span class="dt">col=</span><span class="st">&quot;blue&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;&quot;</span>, </span>
<span id="cb2-17"><a href="#cb2-17"></a>      <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">cex=</span><span class="dv">2</span>)</span>
<span id="cb2-18"><a href="#cb2-18"></a></span>
<span id="cb2-19"><a href="#cb2-19"></a><span class="co"># Get and plot the density from another F distribution</span></span>
<span id="cb2-20"><a href="#cb2-20"></a><span class="co"># Set the degrees of freedom to be (30,2)</span></span>
<span id="cb2-21"><a href="#cb2-21"></a>density3 &lt;-<span class="st"> </span><span class="kw">df</span>(x, <span class="dt">df1=</span><span class="dv">30</span>, <span class="dt">df2=</span><span class="dv">2</span>)</span>
<span id="cb2-22"><a href="#cb2-22"></a><span class="kw">lines</span>(x, density3, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;&quot;</span>, </span>
<span id="cb2-23"><a href="#cb2-23"></a>      <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">cex=</span><span class="dv">2</span>)</span>
<span id="cb2-24"><a href="#cb2-24"></a></span>
<span id="cb2-25"><a href="#cb2-25"></a><span class="co"># Get and plot the density from another F distribution</span></span>
<span id="cb2-26"><a href="#cb2-26"></a><span class="co"># Set the degrees of freedom to be (30,30)</span></span>
<span id="cb2-27"><a href="#cb2-27"></a>density4 &lt;-<span class="st"> </span><span class="kw">df</span>(x, <span class="dt">df1=</span><span class="dv">30</span>, <span class="dt">df2=</span><span class="dv">30</span>)</span>
<span id="cb2-28"><a href="#cb2-28"></a><span class="kw">lines</span>(x, density4, <span class="dt">col=</span><span class="st">&quot;purple&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;&quot;</span>, </span>
<span id="cb2-29"><a href="#cb2-29"></a>      <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">cex=</span><span class="dv">2</span>)</span>
<span id="cb2-30"><a href="#cb2-30"></a></span>
<span id="cb2-31"><a href="#cb2-31"></a><span class="co"># Add legends</span></span>
<span id="cb2-32"><a href="#cb2-32"></a><span class="kw">text</span>(<span class="dv">3</span>, <span class="fl">0.90</span>, <span class="st">&quot;F (2,2)&quot;</span>,   <span class="dt">col=</span><span class="st">&quot;black&quot;</span>,  <span class="dt">cex=</span><span class="fl">1.5</span>)</span>
<span id="cb2-33"><a href="#cb2-33"></a><span class="kw">text</span>(<span class="dv">3</span>, <span class="fl">0.80</span>, <span class="st">&quot;F (2,30)&quot;</span>,  <span class="dt">col=</span><span class="st">&quot;blue&quot;</span>,   <span class="dt">cex=</span><span class="fl">1.5</span>)</span>
<span id="cb2-34"><a href="#cb2-34"></a><span class="kw">text</span>(<span class="dv">3</span>, <span class="fl">0.70</span>, <span class="st">&quot;F (30,2)&quot;</span>,  <span class="dt">col=</span><span class="st">&quot;red&quot;</span>,    <span class="dt">cex=</span><span class="fl">1.5</span>)</span>
<span id="cb2-35"><a href="#cb2-35"></a><span class="kw">text</span>(<span class="dv">3</span>, <span class="fl">0.60</span>, <span class="st">&quot;F (30,30)&quot;</span>, <span class="dt">col=</span><span class="st">&quot;purple&quot;</span>, <span class="dt">cex=</span><span class="fl">1.5</span>)</span></code></pre></div>
<p><img src="S10_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<hr />
</div>
</div>
<div id="calculating-the-p-value-manually" class="section level1">
<h1>Calculating the p-value manually</h1>
<p>Further, we will calculate the p-value for any given F-value. If the p-value is small, the data provide convincing evidence that at least one pair of group means is different from each other. If the p-value is large, the data <strong>do not provide convincing evidence that at least one pair of group means is different from each other</strong>, and thus, the observed differences in sample means are attributable to sampling variability (or chance).</p>
<p>For the section example, let’s write down H0 and H1:</p>
<ul>
<li><p>H0: There is no difference in mean Cd concentration of the <code>4</code> populations (<span class="math inline">\(\mu_1 = \mu_2 = \mu_3 = \mu_4\)</span>)</p></li>
<li><p>H1: At least mean Cd concentration in one population differs from the others</p></li>
</ul>
<p>In this case, the <em>F</em>-statistic is <code>4.66</code>, assuming H0 is true. Then the p-value can be calculated manually:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># Sub-samples</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>Control  &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.64</span>, <span class="fl">0.91</span>, <span class="fl">0.84</span>, <span class="fl">0.41</span>, <span class="fl">1.58</span>, <span class="fl">0.48</span>, <span class="fl">0.88</span>, <span class="fl">0.74</span>, <span class="fl">1.09</span>, <span class="fl">1.28</span>)</span>
<span id="cb3-3"><a href="#cb3-3"></a>P1       &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">1.20</span>, <span class="fl">1.17</span>, <span class="fl">0.76</span>, <span class="fl">0.92</span>, <span class="fl">0.65</span>, <span class="fl">1.14</span>, <span class="fl">1.05</span>, <span class="fl">1.28</span>, <span class="fl">0.89</span>, <span class="fl">1.06</span>)</span>
<span id="cb3-4"><a href="#cb3-4"></a>P2       &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.25</span>, <span class="fl">1.31</span>, <span class="fl">0.43</span>, <span class="fl">1.18</span>, <span class="fl">1.02</span>, <span class="fl">0.83</span>, <span class="fl">1.02</span>, <span class="fl">0.66</span>, <span class="fl">0.70</span>, <span class="fl">0.83</span>)</span>
<span id="cb3-5"><a href="#cb3-5"></a>P3       &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.63</span>, <span class="fl">0.30</span>, <span class="fl">0.49</span>, <span class="fl">0.01</span>, <span class="fl">0.63</span>, <span class="fl">0.69</span>, <span class="fl">0.68</span>, <span class="fl">0.34</span>, <span class="fl">1.09</span>, <span class="fl">0.42</span>)</span>
<span id="cb3-6"><a href="#cb3-6"></a></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="co"># Number of levels</span></span>
<span id="cb3-8"><a href="#cb3-8"></a>M        &lt;-<span class="st"> </span><span class="dv">4</span></span>
<span id="cb3-9"><a href="#cb3-9"></a></span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="co"># The overall sample and its size</span></span>
<span id="cb3-11"><a href="#cb3-11"></a>Sample   &lt;-<span class="st"> </span><span class="kw">c</span>(Control, P1, P2, P3)</span>
<span id="cb3-12"><a href="#cb3-12"></a></span>
<span id="cb3-13"><a href="#cb3-13"></a><span class="co"># Get sample size and degrees of freedom for each sub-sample</span></span>
<span id="cb3-14"><a href="#cb3-14"></a>n1       &lt;-<span class="st"> </span><span class="kw">length</span>(Control)</span>
<span id="cb3-15"><a href="#cb3-15"></a>df1      &lt;-<span class="st"> </span>n1 <span class="dv">-1</span></span>
<span id="cb3-16"><a href="#cb3-16"></a>n2       &lt;-<span class="st"> </span><span class="kw">length</span>(P1)</span>
<span id="cb3-17"><a href="#cb3-17"></a>df2      &lt;-<span class="st"> </span>n2 <span class="dv">-1</span></span>
<span id="cb3-18"><a href="#cb3-18"></a>n3       &lt;-<span class="st"> </span><span class="kw">length</span>(P2)</span>
<span id="cb3-19"><a href="#cb3-19"></a>df3      &lt;-<span class="st"> </span>n3 <span class="dv">-1</span></span>
<span id="cb3-20"><a href="#cb3-20"></a>n4       &lt;-<span class="st"> </span><span class="kw">length</span>(P3)</span>
<span id="cb3-21"><a href="#cb3-21"></a>df4      &lt;-<span class="st"> </span>n4 <span class="dv">-1</span></span>
<span id="cb3-22"><a href="#cb3-22"></a></span>
<span id="cb3-23"><a href="#cb3-23"></a><span class="co"># The overall sample size</span></span>
<span id="cb3-24"><a href="#cb3-24"></a>N        &lt;-<span class="st"> </span>n1 <span class="op">+</span><span class="st"> </span>n2 <span class="op">+</span><span class="st"> </span>n3 <span class="op">+</span><span class="st"> </span>n4</span>
<span id="cb3-25"><a href="#cb3-25"></a></span>
<span id="cb3-26"><a href="#cb3-26"></a><span class="co"># Make data frame</span></span>
<span id="cb3-27"><a href="#cb3-27"></a>Cd_data  &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Cd=</span><span class="kw">c</span>(Control, P1, P2, P3),</span>
<span id="cb3-28"><a href="#cb3-28"></a>                       <span class="dt">group=</span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">&quot;Control&quot;</span>, <span class="kw">length</span>(Control)),</span>
<span id="cb3-29"><a href="#cb3-29"></a>                              <span class="kw">rep</span>(<span class="st">&quot;Plant 1&quot;</span>, <span class="kw">length</span>(P1)),</span>
<span id="cb3-30"><a href="#cb3-30"></a>                              <span class="kw">rep</span>(<span class="st">&quot;Plant 2&quot;</span>, <span class="kw">length</span>(P2)),</span>
<span id="cb3-31"><a href="#cb3-31"></a>                              <span class="kw">rep</span>(<span class="st">&quot;Plant 3&quot;</span>, <span class="kw">length</span>(P3))) )</span>
<span id="cb3-32"><a href="#cb3-32"></a></span>
<span id="cb3-33"><a href="#cb3-33"></a><span class="co"># Compare boxplots</span></span>
<span id="cb3-34"><a href="#cb3-34"></a><span class="kw">ggplot</span>(Cd_data, <span class="kw">aes</span>(<span class="dt">x=</span>group, <span class="dt">y=</span>Cd, <span class="dt">fill=</span>group)) <span class="op">+</span></span>
<span id="cb3-35"><a href="#cb3-35"></a><span class="st">  </span><span class="kw">geom_boxplot</span>() <span class="op">+</span></span>
<span id="cb3-36"><a href="#cb3-36"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Soil Cd concentrations under different conditions&quot;</span>, </span>
<span id="cb3-37"><a href="#cb3-37"></a>       <span class="dt">x=</span><span class="st">&quot;Group&quot;</span>, <span class="dt">y=</span><span class="st">&quot;Cd concentration [mg/kg]&quot;</span>) <span class="op">+</span></span>
<span id="cb3-38"><a href="#cb3-38"></a><span class="st">  </span><span class="kw">theme_classic</span>()</span></code></pre></div>
<p><img src="S10_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># Degrees of freedoms of variability between groups</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>df_B     &lt;-<span class="st"> </span>M<span class="dv">-1</span></span>
<span id="cb4-3"><a href="#cb4-3"></a></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="co"># Degrees of freedoms of variability within groups</span></span>
<span id="cb4-5"><a href="#cb4-5"></a>df_W     &lt;-<span class="st"> </span>N <span class="op">-</span><span class="st"> </span>M</span>
<span id="cb4-6"><a href="#cb4-6"></a></span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="co"># Compute SST</span></span>
<span id="cb4-8"><a href="#cb4-8"></a>SST      &lt;-<span class="st"> </span><span class="kw">sd</span>(Sample)<span class="op">^</span><span class="dv">2</span><span class="op">*</span>(N<span class="dv">-1</span>)</span>
<span id="cb4-9"><a href="#cb4-9"></a></span>
<span id="cb4-10"><a href="#cb4-10"></a><span class="co"># Compute SSW</span></span>
<span id="cb4-11"><a href="#cb4-11"></a>SSW      &lt;-<span class="st"> </span><span class="kw">sd</span>(Control)<span class="op">^</span><span class="dv">2</span><span class="op">*</span>(n1<span class="dv">-1</span>) <span class="op">+</span></span>
<span id="cb4-12"><a href="#cb4-12"></a><span class="st">           </span><span class="kw">sd</span>(P1)<span class="op">^</span><span class="dv">2</span><span class="op">*</span>(n2<span class="dv">-1</span>) <span class="op">+</span></span>
<span id="cb4-13"><a href="#cb4-13"></a><span class="st">           </span><span class="kw">sd</span>(P2)<span class="op">^</span><span class="dv">2</span><span class="op">*</span>(n3<span class="dv">-1</span>) <span class="op">+</span></span>
<span id="cb4-14"><a href="#cb4-14"></a><span class="st">           </span><span class="kw">sd</span>(P3)<span class="op">^</span><span class="dv">2</span><span class="op">*</span>(n4<span class="dv">-1</span>)</span>
<span id="cb4-15"><a href="#cb4-15"></a></span>
<span id="cb4-16"><a href="#cb4-16"></a><span class="co"># Compute SSB</span></span>
<span id="cb4-17"><a href="#cb4-17"></a>SSB      &lt;-<span class="st"> </span>n1<span class="op">*</span>(<span class="kw">mean</span>(Control)<span class="op">-</span><span class="kw">mean</span>(Sample))<span class="op">^</span><span class="dv">2</span> <span class="op">+</span></span>
<span id="cb4-18"><a href="#cb4-18"></a><span class="st">           </span>n2<span class="op">*</span>(<span class="kw">mean</span>(P1)<span class="op">-</span><span class="kw">mean</span>(Sample))<span class="op">^</span><span class="dv">2</span> <span class="op">+</span></span>
<span id="cb4-19"><a href="#cb4-19"></a><span class="st">           </span>n3<span class="op">*</span>(<span class="kw">mean</span>(P2)<span class="op">-</span><span class="kw">mean</span>(Sample))<span class="op">^</span><span class="dv">2</span> <span class="op">+</span></span>
<span id="cb4-20"><a href="#cb4-20"></a><span class="st">           </span>n4<span class="op">*</span>(<span class="kw">mean</span>(P3)<span class="op">-</span><span class="kw">mean</span>(Sample))<span class="op">^</span><span class="dv">2</span></span>
<span id="cb4-21"><a href="#cb4-21"></a></span>
<span id="cb4-22"><a href="#cb4-22"></a><span class="co"># Check SST = SSB + SSW</span></span>
<span id="cb4-23"><a href="#cb4-23"></a>SST <span class="op">-</span>SSB <span class="op">-</span><span class="st"> </span>SSW</span></code></pre></div>
<pre><code>## [1] 8.881784e-16</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># Get F-statistic</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>MSB      &lt;-<span class="st"> </span>SSB<span class="op">/</span>df_B</span>
<span id="cb6-3"><a href="#cb6-3"></a>MSW      &lt;-<span class="st"> </span>SSW<span class="op">/</span>df_W</span>
<span id="cb6-4"><a href="#cb6-4"></a>F_ratio  &lt;-<span class="st"> </span>MSB<span class="op">/</span>MSW</span>
<span id="cb6-5"><a href="#cb6-5"></a></span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="co"># Find the p-value</span></span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="co"># The pf() function gives the Cumulative Distribution Function (CDF) </span></span>
<span id="cb6-8"><a href="#cb6-8"></a><span class="co"># of the F distribution in R, which is the probability that </span></span>
<span id="cb6-9"><a href="#cb6-9"></a><span class="co"># the variable takes a value lower or equal to a threshold (here F_ratio).</span></span>
<span id="cb6-10"><a href="#cb6-10"></a><span class="co"># Here we that 1-pf to get the probability that the </span></span>
<span id="cb6-11"><a href="#cb6-11"></a><span class="co"># variable takes a value higher than the threshold (F_ratio).</span></span>
<span id="cb6-12"><a href="#cb6-12"></a><span class="co"># Notice F distribution is defined by two degrees of freedom (df_B and df_W).</span></span>
<span id="cb6-13"><a href="#cb6-13"></a>P_value  &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">pf</span>(F_ratio, <span class="dt">df1=</span>df_B, <span class="dt">df2=</span>df_W)</span>
<span id="cb6-14"><a href="#cb6-14"></a></span>
<span id="cb6-15"><a href="#cb6-15"></a><span class="kw">print</span>(P_value)</span></code></pre></div>
<pre><code>## [1] 0.007475642</code></pre>
<p>Now, we have a probability of about <code>0.7%</code> getting a statistic (<em>F</em>) as extreme or more extreme than the observed statistic (<code>4.66</code>), assuming H0 is true. This is a small probability, and is likely due to chance. We can reject H0 given the observations. Thus, at least the mean Cd concentration in one population differs from the others.</p>
<hr />
</div>
<div id="one-way-anova-with-r" class="section level1">
<h1>One-way ANOVA with R</h1>
<p>In R, the previous steps can be done in one line:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="kw">oneway.test</span>(Cd <span class="op">~</span><span class="st"> </span>group, <span class="dt">data=</span>Cd_data, <span class="dt">var.equal=</span>T) </span></code></pre></div>
<pre><code>## 
##  One-way analysis of means
## 
## data:  Cd and group
## F = 4.6617, num df = 3, denom df = 36, p-value = 0.007476</code></pre>
<p>Here we put <code>var.equal = T</code> when call the <code>oneway.test()</code> function. By doing so, we assume equal SD in the populations, similar to the “equal SD” method used in the <a href="https://zhu-group.github.io/ese335/S07.html#Independent_two-sample_t-test">independent two-sample t-test</a>. By default, R uses unequal <code>SD</code> in populations (<code>var.equal = F</code>), which becomes the Welch test and which returns a different <em>F</em> statistic and degrees of freedom. We will look at this in the future.</p>
<p>Another way to perform the one-way ANOVA with R is calling the <code>aov()</code> and <code>summary()</code> functions. By doing so, R returns the full ANOVA table (df<sub>B</sub>, df<sub>W</sub>, SS<sub>B</sub>, SS<sub>W</sub>, MSB, MSW, <em>F</em> ratio, and p-value) and you can also save the ANOVA for post analysis (e.g., post-hoc test).</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>res_aov &lt;-<span class="st"> </span><span class="kw">aov</span>(Cd <span class="op">~</span><span class="st"> </span>group, <span class="dt">data=</span>Cd_data)</span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="kw">summary</span>(res_aov)</span></code></pre></div>
<pre><code>##             Df Sum Sq Mean Sq F value  Pr(&gt;F)   
## group        3  1.261  0.4204   4.662 0.00748 **
## Residuals   36  3.246  0.0902                   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<hr />
</div>
<div id="in-class-exercises" class="section level1">
<h1>In-class exercises</h1>
<div id="exercise-1" class="section level2">
<h2>Exercise #1</h2>
<p>An environmentalist wanted to determine if the mean acidity of rain differs among <code>3</code> cities. The environmentalist randomly selected <code>6</code> rain dates at each site obtained the following data:</p>
<ul>
<li><p>City #1: <code>5.11, 5.01, 4.90, 5.14, 4.80, 5.24</code></p></li>
<li><p>City #2: <code>4.87, 4.18, 4.40, 4.67, 4.89, 4.09</code></p></li>
<li><p>City #3: <code>5.46, 6.29, 5.57, 5.15, 5.45, 5.30</code></p></li>
</ul>
<p>So, does the mean acidity of rain differ among the <code>3</code> cities?</p>
</div>
<div id="exercise-2" class="section level2">
<h2>Exercise #2</h2>
<p>To study the impact of sunlight on a specific organic compound’s decomposition rate, one researcher observes the decomposition ratio (%) of it in <code>24</code> hours under <code>6</code> sunlight conditions. The sunlight conditions are strictly controlled. The decomposition ratio is measured repeatedly and independently under each condition. (Example and data are from Shu Tao, <em>Applied statistical methods</em>, 246-247, 1994.)</p>
<ul>
<li><p>Condition #1: <code>19.4, 32.6, 27.0, 32.1, 33.0</code></p></li>
<li><p>Condition #2: <code>17.7, 24.8, 27.9, 25.2, 24.3</code></p></li>
<li><p>Condition #3: <code>20.7, 21.0, 20.5, 18.8, 18.6</code></p></li>
<li><p>Condition #4: <code>17.3, 19.4, 19.1, 16.9, 20.8</code></p></li>
<li><p>Condition #5: <code>17.0, 19.4, 9.1, 11.9, 15.8</code></p></li>
<li><p>Condition #6: <code>14.3, 14.4, 11.8, 11.6, 14.2</code></p></li>
</ul>
<p>Do the observations support the idea that sunlight has an impact on the decomposition rate of this organic compound?</p>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = false;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
