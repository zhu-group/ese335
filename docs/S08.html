<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Section 08 Paired sample t-test and confidence interval</title>

<script src="site_libs/header-attrs-2.24/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/font-awesome-6.4.2/css/all.min.css" rel="stylesheet" />
<link href="site_libs/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>







<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Environmental Data Analysis</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="Syllabus.html">
    <span class="fa fa-bell-o"></span>
     
    Syllabus
  </a>
</li>
<li>
  <a href="Schedule.html">
    <span class="fa fa-calendar"></span>
     
    Schedule
  </a>
</li>
<li>
  <a href="Resource.html">
    <span class="fa fa-wrench"></span>
     
    Resource
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-laptop"></span>
     
    Assignments
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="A01.html">Assignment 01</a>
    </li>
    <li>
      <a href="A02.html">Assignment 02</a>
    </li>
    <li>
      <a href="A03.html">Assignment 03</a>
    </li>
    <li>
      <a href="A04.html">Assignment 04</a>
    </li>
    <li>
      <a href="A05.html">Assignment 05</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Section 08 Paired sample t-test and
confidence interval</h1>

</div>


<hr />
<div id="prerequisites" class="section level1">
<h1>Prerequisites</h1>
<p>Load the libraries with R:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(nortest)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code></pre></div>
<hr />
</div>
<div id="section-example-covid-19-lockdown-and-air-quality"
class="section level1">
<h1>Section Example: COVID-19 lockdown and air quality</h1>
<p><img src="figs/gr1_lrg.jpg" alt="drawing" width="600"/></p>
<p><a
href="https://www.thelancet.com/journals/lanplh/article/PIIS2542-5196(20)30201-1/fulltext">Figure
Source</a></p>
<p>The COVID-19 pandemic outbreak has reshaped normal social and
economic activities dramatically, resulting in sudden changes in the
emissions of air pollutants and their precursors. To investigate the
impact of lockdown on air quality, we compare monthly PM2.5 (ug
m<sup>-3</sup>) in February of 2019 and 2020 in the following
<code>15</code> cities.</p>
<table>
<thead>
<tr class="header">
<th align="center">City</th>
<th align="center">2019</th>
<th align="center">2020</th>
<th align="center">2020-2019</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">Beijing</td>
<td align="center">53</td>
<td align="center">63</td>
<td align="center">-10</td>
</tr>
<tr class="even">
<td align="center">Shanghai</td>
<td align="center">41</td>
<td align="center">33</td>
<td align="center">-8</td>
</tr>
<tr class="odd">
<td align="center">Guangzhou</td>
<td align="center">26</td>
<td align="center">24</td>
<td align="center">-2</td>
</tr>
<tr class="even">
<td align="center">Shenzhen</td>
<td align="center">19</td>
<td align="center">19</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="center">Kunming</td>
<td align="center">26</td>
<td align="center">33</td>
<td align="center">+7</td>
</tr>
<tr class="even">
<td align="center">Chongqing</td>
<td align="center">48</td>
<td align="center">49</td>
<td align="center">+1</td>
</tr>
<tr class="odd">
<td align="center">Wuhan</td>
<td align="center">64</td>
<td align="center">38</td>
<td align="center">-26</td>
</tr>
<tr class="even">
<td align="center">Hangzhou</td>
<td align="center">46</td>
<td align="center">28</td>
<td align="center">-18</td>
</tr>
<tr class="odd">
<td align="center">Lanzhou</td>
<td align="center">42</td>
<td align="center">41</td>
<td align="center">-1</td>
</tr>
<tr class="even">
<td align="center">Hefei</td>
<td align="center">65</td>
<td align="center">36</td>
<td align="center">-29</td>
</tr>
<tr class="odd">
<td align="center">Changsha</td>
<td align="center">53</td>
<td align="center">41</td>
<td align="center">-12</td>
</tr>
<tr class="even">
<td align="center">Changchun</td>
<td align="center">81</td>
<td align="center">43</td>
<td align="center">-38</td>
</tr>
<tr class="odd">
<td align="center">Dalian</td>
<td align="center">51</td>
<td align="center">43</td>
<td align="center">-8</td>
</tr>
<tr class="even">
<td align="center">Fuzhou</td>
<td align="center">32</td>
<td align="center">23</td>
<td align="center">-9</td>
</tr>
<tr class="odd">
<td align="center">Nanning</td>
<td align="center">44</td>
<td align="center">35</td>
<td align="center">-9</td>
</tr>
<tr class="even">
<td align="center">Mean</td>
<td align="center">46.1</td>
<td align="center">36.6</td>
<td align="center">-9.5</td>
</tr>
</tbody>
</table>
<p><a
href="http://www.mee.gov.cn/hjzl/dqhj/cskqzlzkyb/index_1.shtml">Data
source</a></p>
<p>It seems the mean PM2.5 level is lower in 2020. Can such a difference
be explained on the basis of chance variation?</p>
<p>Can we use the <a
href="https://zhu-group.github.io/ese335/S07.html#Independent_two-sample_t-test_with_R">independent
two-sample t-test</a> from the last Section to test the significance of
such difference? Why or why not?</p>
<hr />
</div>
<div id="the-paired-sample-t-test" class="section level1">
<h1>The paired sample t-test</h1>
<p>A <em>paired sample t-test</em>, also called the
<strong>dependent</strong> sample t-test, is used to compare two
population means in the case of two samples that are
<strong>correlated</strong>. Two measurements are paired when they come
from the same observational unit. The pairing has nothing to do with the
actual data values but, rather, with the way the data values are
obtained. Examples of where this might occur are:</p>
<ul>
<li><p>Before-and-after observations on the same subjects
(e.g. pollutant levels before and after a particular
treatment).</p></li>
<li><p>A comparison of two different methods of measurement or two
different treatments where the measurements/treatments are applied to
the same subjects (e.g. pollutant measurements using a remote sensing
method and a <em>in situ</em> technology).</p></li>
</ul>
<p>The paired-sample t-test is the same as the <a
href="https://zhu-group.github.io/ese335/S06.html#One_sample_t-test">one-sample
t-test</a> as the difference (<span class="math inline">\(D\)</span>)
between the two populations (<span class="math inline">\(X_1\)</span>
and <span class="math inline">\(X_2\)</span>) is tested against
zero.</p>
<p>Recall the definition of t-Ratio:</p>
<p><span class="math display">\[t=\frac {Estimate - Parameter}
{SE(Estimate)}  \]</span> Here the standard error (SE) refers to the
sample. If <span class="math inline">\(s\)</span> is the sample SD of
the difference, the SE for the estimate (<span
class="math inline">\(\overline {D}\)</span>) is:</p>
<p><span class="math display">\[SE(\overline {D})=\frac {s}
{\sqrt{n}}\]</span> For a paired sample t-test:</p>
<p><span class="math display">\[ t =\frac { \overline{D}  - \mu_D } {
{s} / \sqrt{n} } \]</span> And <span class="math inline">\(t\)</span>
statistic follows a Student’s t distribution on <span
class="math inline">\(n - 1\)</span> degrees of freedom.</p>
<p>For our research question,</p>
<ul>
<li><p>H0: Mean PM2.5 in the Feb. of 2020 is the same as that in 2019 in
the given cities (<span class="math inline">\(\mu_D =
0\)</span>)</p></li>
<li><p>H1: Mean PM2.5 in the Feb. of 2020 is not the same as that in
2019 in the given cities (<span class="math inline">\(\mu_D \ne
0\)</span>)</p></li>
</ul>
<p>In this case, <span class="math inline">\(\overline D\)</span> is
<code>-9.47</code>, <span
class="math inline">\(SE(\overline{D})\)</span> is <code>3.47</code>,
assuming H0 is true (<span class="math inline">\(\mu_D = 0\)</span>), we
have <span class="math inline">\(t\)</span>=<code>-2.73</code>.</p>
<p>Then the p-value can be calculated manually:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># PM2.5 in 2019 Feb.</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>PM2<span class="fl">.5</span>_2019  <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">53</span>, <span class="dv">41</span>, <span class="dv">26</span>, <span class="dv">19</span>, <span class="dv">26</span>, <span class="dv">48</span>, <span class="dv">64</span>, <span class="dv">46</span>, <span class="dv">42</span>, <span class="dv">65</span>, <span class="dv">53</span>, <span class="dv">81</span>, <span class="dv">51</span>, <span class="dv">32</span>, <span class="dv">44</span>)</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co"># PM2.5 in 2020 Feb.</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>PM2<span class="fl">.5</span>_2020  <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">63</span>, <span class="dv">33</span>, <span class="dv">24</span>, <span class="dv">19</span>, <span class="dv">33</span>, <span class="dv">49</span>, <span class="dv">38</span>, <span class="dv">28</span>, <span class="dv">41</span>, <span class="dv">36</span>, <span class="dv">41</span>, <span class="dv">43</span>, <span class="dv">43</span>, <span class="dv">23</span>, <span class="dv">35</span>)</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="co"># Make data frame</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>PM2<span class="fl">.5</span>_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">PM2.5 =</span> <span class="fu">c</span>(PM2<span class="fl">.5</span>_2019, PM2<span class="fl">.5</span>_2020),</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>                         <span class="at">Year =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;2019-02&quot;</span>,n),<span class="fu">rep</span>(<span class="st">&quot;2020-02&quot;</span>,n)))</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="co"># Compare boxplots</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>PM2<span class="fl">.5</span>_data <span class="sc">%&gt;%</span> </span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="fu">as.character</span>(Year), <span class="at">y=</span>PM2<span class="fl">.5</span>)) <span class="sc">+</span></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">fill=</span><span class="st">&quot;steelblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;PM2.5 Distribution by Year&quot;</span>, <span class="at">x=</span><span class="st">&quot;Year&quot;</span>, <span class="at">y=</span><span class="st">&quot;ug/m3&quot;</span>)</span></code></pre></div>
<p><img src="S08_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># Sample difference</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>Diff        <span class="ot">&lt;-</span> PM2<span class="fl">.5</span>_2020 <span class="sc">-</span> PM2<span class="fl">.5</span>_2019</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co"># Get sample size, degrees of freedom, and sd</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>n           <span class="ot">&lt;-</span> <span class="fu">length</span>(Diff)</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>df          <span class="ot">&lt;-</span> n <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>sd          <span class="ot">&lt;-</span> <span class="fu">sd</span>(Diff)</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="co"># Check normality, qqplot</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="fu">ggqqplot</span>(Diff)</span></code></pre></div>
<p><img src="S08_files/figure-html/unnamed-chunk-2-2.png" width="672" /></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># Check normality, Shapiro-Wilk test</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="fu">shapiro.test</span>(Diff)</span></code></pre></div>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  Diff
## W = 0.94471, p-value = 0.4453</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co"># SE of the difference</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>SE          <span class="ot">&lt;-</span> sd<span class="sc">/</span><span class="fu">sqrt</span>(n)</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="co"># Get t-ratio</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>t           <span class="ot">&lt;-</span> <span class="fu">mean</span>(Diff)<span class="sc">/</span>SE</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="co"># Find the two-sided p-value</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="co"># The pt function gives the Cumulative Distribution Function (CDF) </span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="co"># of the Student&#39;s t distribution in R, which is the probability that </span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="co"># the variable takes a value lower or equal to a threshold (here |t|).</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>P_value     <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">-</span><span class="fu">pt</span>(<span class="fu">abs</span>(t), <span class="at">df=</span>df))<span class="sc">*</span><span class="dv">2</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="fu">print</span>(P_value)</span></code></pre></div>
<pre><code>## [1] 0.01635031</code></pre>
<p>Now, we have a probability of about <code>1.6%</code> getting a
statistic (<span class="math inline">\(t\)</span>) as extreme or more
extreme than the observed statistic (<code>-2.73</code>), assuming H0 is
true. This is a small probability, and is not likely due to chance. We,
therefore, reject H0 given the observations. Thus, mean PM2.5 in the
Feb. of 2020 is <strong>statistically significant</strong> different
from that in 2019 in the given cities. The observations
<strong>suggest</strong> that the massive lockdown in China during 2020
Feb. may lead to a lower PM2.5 level, compared with the same period in
2019.</p>
<hr />
</div>
<div id="paired-sample-t-test-with-r" class="section level1">
<h1>Paired sample t-test with R</h1>
<p>In R, you can simply conduct the previous paired sample t-test
as:</p>
<ul>
<li><p>H0: Mean PM2.5 in the Feb. of 2020 is the same as that in 2019 in
the given cities (<span class="math inline">\(\mu_D =
0\)</span>)</p></li>
<li><p>H1: Mean PM2.5 in the Feb. of 2020 is not the same as that in
2019 in the given cities (<span class="math inline">\(\mu_D \ne
0\)</span>)</p></li>
</ul>
<p>In R, this is done by:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co"># PM2.5 in 2019 Feb.</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>PM2<span class="fl">.5</span>_2019  <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">53</span>, <span class="dv">41</span>, <span class="dv">26</span>, <span class="dv">19</span>, <span class="dv">26</span>, <span class="dv">48</span>, <span class="dv">64</span>, <span class="dv">46</span>, <span class="dv">42</span>, <span class="dv">65</span>, <span class="dv">53</span>, <span class="dv">81</span>, <span class="dv">51</span>, <span class="dv">32</span>, <span class="dv">44</span>)</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="co"># PM2.5 in 2020 Feb.</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>PM2<span class="fl">.5</span>_2020  <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">63</span>, <span class="dv">33</span>, <span class="dv">24</span>, <span class="dv">19</span>, <span class="dv">33</span>, <span class="dv">49</span>, <span class="dv">38</span>, <span class="dv">28</span>, <span class="dv">41</span>, <span class="dv">36</span>, <span class="dv">41</span>, <span class="dv">43</span>, <span class="dv">43</span>, <span class="dv">23</span>, <span class="dv">35</span>)</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="co"># Call t.test function</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="co"># Here we compare the sample average with a known mean (0)</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="co"># Since H1 states a different PM2.5 level in 2020,</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="co"># we use two-sided p-value</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="co"># Pay attention the order of two samples</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a><span class="fu">t.test</span>(PM2<span class="fl">.5</span>_2020, PM2<span class="fl">.5</span>_2019, <span class="at">alternative=</span><span class="st">&quot;two.sided&quot;</span>, <span class="at">paired=</span>T)</span></code></pre></div>
<pre><code>## 
##  Paired t-test
## 
## data:  PM2.5_2020 and PM2.5_2019
## t = -2.7275, df = 14, p-value = 0.01635
## alternative hypothesis: true mean difference is not equal to 0
## 95 percent confidence interval:
##  -16.910760  -2.022573
## sample estimates:
## mean difference 
##       -9.466667</code></pre>
<p>Here we set <code>paired=T</code> when call the <code>t.test()</code>
function. By doing so, R knows we would like to do a paired sample
t-test.</p>
<hr />
</div>
<div id="confidence-interval-for-the-difference" class="section level1">
<h1>Confidence interval for the difference</h1>
<p>As you may notice, another thing comes out from the proceeding t-test
is a range (<code>-16.9</code> to <code>-2.0</code>), called <em>95
percent confidence interval</em>. A confidence interval (CI) refers to
<strong>the probability that a population parameter will fall between a
set of values for a certain proportion of times</strong>.</p>
<p>Confidence intervals measure the degree of uncertainty or certainty
in a sampling method. They can take any number of probability limits,
with the most common being a <code>95%</code> or <code>99%</code>
<strong>confidence level</strong>. From the proceeding t-test, the
<code>95%</code> CI can be stated as: <code>95%</code> of times <span
class="math inline">\(\mu_D\)</span> will fall within the range between
<code>-16.9</code> and <code>-2.0</code>.</p>
<p>Let’s use the definition of <span class="math inline">\(t\)</span>
ratio to understand the confidence intervals.</p>
<p><span class="math display">\[ t =\frac { \overline{D}  - \mu_D } {
{s} / \sqrt{n} } \sim t_{df=n-1} \]</span> For a given t distribution on
the degrees of freedom of n-1, <code>95%</code> of values in this
distribution will fall between two endpoints that make the corresponding
probability of <code>95%</code>. In this case (d.f.=<code>14</code>),
it’s <code>-2.14</code> and <code>2.14</code>:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="co"># Make a vector from -5 to 5, with a step of 0.01 </span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>x        <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">5.0</span>, <span class="fl">5.0</span>, <span class="at">by=</span><span class="fl">0.01</span>)</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="co"># Compute the density for each element in x</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="co"># Set the degrees of freedom to be 14</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>density <span class="ot">&lt;-</span> <span class="fu">dt</span>(x, <span class="at">df=</span><span class="dv">14</span>)</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="co"># Plot Density</span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="fu">plot</span>(x, density, <span class="at">col=</span><span class="st">&quot;black&quot;</span>, <span class="at">xlab=</span><span class="st">&quot;&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;Density&quot;</span>, </span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a>     <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">cex=</span><span class="dv">2</span>, </span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a>     <span class="at">xlim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">5.0</span>, <span class="fl">5.0</span>),</span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot;PDF of t (d.f. = 14) distribution&quot;</span>)</span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a><span class="co"># Get the 2.5th percentile</span></span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a>p_2<span class="fl">.5</span>th  <span class="ot">&lt;-</span> <span class="fu">qt</span>(<span class="fl">0.025</span>,<span class="at">df=</span><span class="dv">14</span>)</span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a><span class="co"># Get the 97.5th percentile</span></span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a>p_97<span class="fl">.5</span>th <span class="ot">&lt;-</span> <span class="fu">qt</span>(<span class="fl">0.975</span>,<span class="at">df=</span><span class="dv">14</span>)</span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a></span>
<span id="cb10-20"><a href="#cb10-20" tabindex="-1"></a><span class="co"># Add vertical lines</span></span>
<span id="cb10-21"><a href="#cb10-21" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span>p_2<span class="fl">.5</span>th,  <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb10-22"><a href="#cb10-22" tabindex="-1"></a><span class="fu">text</span>(p_2<span class="fl">.5</span>th<span class="dv">-1</span>, <span class="fl">0.1</span>, <span class="fu">as.character</span>(<span class="fu">round</span>(p_2<span class="fl">.5</span>th,<span class="dv">2</span>)), <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">cex=</span><span class="fl">1.5</span>)</span>
<span id="cb10-23"><a href="#cb10-23" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span>p_97<span class="fl">.5</span>th, <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb10-24"><a href="#cb10-24" tabindex="-1"></a><span class="fu">text</span>(p_97<span class="fl">.5</span>th<span class="sc">+</span><span class="dv">1</span>, <span class="fl">0.1</span>, <span class="fu">as.character</span>(<span class="fu">round</span>(p_97<span class="fl">.5</span>th,<span class="dv">2</span>)), <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">cex=</span><span class="fl">1.5</span>)</span></code></pre></div>
<p><img src="S08_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>That is, if we randomly draw <code>10000</code> samples (<span
class="math inline">\(X_1 -X_2\)</span>), <code>9500</code> of those
samples would have a <span class="math inline">\(t\)</span> ratio that
falls between <code>-2.14</code> and <code>2.14</code> in theory, and
<code>500</code> of those samples would fall outside the interval. For
the <code>9500</code> samples that with <span
class="math inline">\(t\)</span> ratio between <code>-2.14</code> and
<code>2.14</code>, so we have:</p>
<p><span class="math display">\[ -2.14 \le \frac { \overline{D}  - \mu_D
} { {s} / \sqrt{n} } \le 2.14  \]</span> which is equivalent to say
that, <code>9500</code> of the <code>10000</code> times the unknown
population mean (<span class="math inline">\(\mu_D\)</span>) would be
within the following interval:</p>
<p><span class="math display">\[ \overline{D} - 2.14 * \frac {s}
{\sqrt{n}} \le \mu_D \le \overline{D} + 2.14 * \frac {s}
{\sqrt{n}}  \]</span> and we have:</p>
<p><span class="math display">\[ -16.9 \le \mu_D \le -2.0  \]</span>
This is exactly the same as the R output. Now, we understand that this
range represents that <code>95%</code> of the time the unknown
population mean (<span class="math inline">\(\mu_D\)</span>) would fall
within the range between <code>-16.9</code> and <code>-2.0</code>. As
such, mean PM2.5 level in 2020 Feb. is lower than that in 2019 by
<code>16.9</code> to <code>2.0</code> ug m<sup>-3</sup> (95% CI). Or
another way to put it, PM2.5 level in 2020 Feb. on average is lower than
that in 2019 by <code>16.9</code> to <code>2.0</code> ug m<sup>-3</sup>
(95% CI).</p>
<p>A general way to write the CI (<code>100(1-x)%</code> confidence
level) of unknown population mean (<span
class="math inline">\(\mu_D\)</span>) would be:</p>
<p><span class="math display">\[ \overline{D} - t_{df=n-1}(1-0.5x) \frac
{s} {\sqrt{n}} \le \mu_D \le \overline{D} + t_{df=n-1}(1-0.5x) \frac {s}
{\sqrt{n}}  \]</span> where <span
class="math inline">\(t_{df=n-1}(1-0.5x)\)</span> is the
<code>100(1-0.5x)</code>th percentile of the t distribution on <span
class="math inline">\(n-1\)</span> degrees of freedom.</p>
<p>In fact, we have seen CI as default R output from the <a
href="https://zhu-group.github.io/ese335/S06.html#One_sample_t-test">one-sample
t-test</a> and <a
href="https://zhu-group.github.io/ese335/S07.html#Independent_two-sample_t-test_with_R">independent
two-sample t-test</a>. You should be able to explain the meaning of each
CI. Please try.</p>
<hr />
</div>
<div id="in-class-exercises" class="section level1">
<h1>In-class exercises</h1>
<div id="exercise-1" class="section level2">
<h2>Exercise #1</h2>
<p>To reduce traffic noise, city X brings in a new regulation of not
using horns within a certain area. A research group measures noise
levels (L<sub>90</sub>) from <code>8</code> representative locations
within this area, before and after the regulation (unit: dB).</p>
<ul>
<li><p>Before the regulation:
<code>51, 48, 52, 62, 64, 51, 55, 60</code></p></li>
<li><p>After the regulation:
<code>46, 45, 53, 48, 57, 55, 42, 50</code></p></li>
</ul>
<p>Based on the observations, is the regulation effective in reducing
the noise of this area?</p>
<p>1.1 Which test will you use?</p>
<p>1.2 What is the H0 and H1?</p>
<p>1.3 Do you use one-sided or two-sided p-value?</p>
<p>1.4 Is the regulation effective in reducing the noise of this area?
Here use a <strong>significant level</strong> of <code>0.05</code>.</p>
<p>1.5 If the regulation is effective in reducing the noise of this
area, then by how much? Report your results using a <strong>confidence
level</strong> of <code>95%</code>.</p>
</div>
<div id="exercise-2" class="section level2">
<h2>Exercise #2</h2>
<p>Suppose we want to test the reliability of a remote sensing method in
measuring CO<sub>2</sub>. For a given location, the in situ measurements
(ppm) for <code>10</code> days read as:</p>
<ul>
<li>In situ:
<code>415, 385, 378, 398, 413, 359, 391, 410, 390, 402</code></li>
</ul>
<p>Meanwhile, the corresponding remote sensing results are:</p>
<ul>
<li>Remote sensing:
<code>412, 361, 401, 432, 413, 385, 378, 412, 420, 400</code></li>
</ul>
<p>2.1 Is this remote sensing method reliable in measuring
CO<sub>2</sub>?</p>
<p>2.2 Report the CI for the difference. Does the 95% CI contain
<code>0</code>? What does that mean in term of determining a significant
difference between the two population means?</p>
</div>
<div id="exercise-3" class="section level2">
<h2>Exercise #3</h2>
<p>Recall the <a
href="https://zhu-group.github.io/ese335/S07.html#Exercise_2">Exercise
#2</a> from Section 07, compute the <code>90%</code>, <code>95%</code>,
and <code>99%</code> CI for the difference between mean COD from the two
rivers. Can you explain why CI is wider for a higher confidence
level?</p>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = false;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
